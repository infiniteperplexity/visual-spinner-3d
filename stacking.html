<!--Distributed under GNU Public License version 3-->
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>VisualSpinner3D Coding Sandbox, by Glenn Wright</title>
</head>
<script src="scripts/vs3d.js"></script>
<script src="scripts/vs3d-moves.js"></script>
<script src="scripts/three.min.js"></script>
<script src="scripts/vs3d-render.js"></script>
<script>

	const {UP, DOWN, LEFT, RIGHT, nearly, angle$nearly} = VS3D;
	// 1A, 1B, 2A, 2B, 3A, 3B
	let moves = {
		p1a: {
			p1b: [
				{hand: {va: 0}, head: {va: -2}}
			],
			p2a: {

			},
			p2b: {

			},
			p3a: [
				{hand: {va: -2}, head: {va: -4}}
			],
			p3b: {
				
			}
		},
		p1b: {
			p1a: [
				{hand: {va: 0}, head: {va: 2}}
			],
			p2a: {

			},
			p2b: {

			},
			p3a: [
				{hand: {va: -2}, head: {va: -6}}
			],
			p3b: {
				
			}
		},
		p2a: {
			p1a: {

			},
			p1b: {

			},
			p2b: {

			},
			p3a: {

			},
			p3b: {
				
			}
		},
		p2b: {
			p1a: {

			},
			p1b: {

			},
			p2a: {

			},
			p3a: {

			},
			p3b: {
				
			}
		},
		p3a: {
			p1a: {

			},
			p1b: [
				{hand: {va: 2}, head: {va: 6}}
			],
			p2a: {

			},
			p2b: {

			},
			p3b: [
				{hand: {va: 0}, head: {va: -2}}
			]
		},
		p3b: {
			p1a: {

			},
			p1b: [
				{hand: {va: 2}, head: {va: 4}}
			],
			p2a: {

			},
			p2b: {

			},
			p3a: [
				{hand: {va: 0}, head: {va: 2}}
			]
		}
	};

	let renderer, player;
	let red = new VS3D.Prop({
		hand: {a: VS3D.RIGHT},
		head: {a: VS3D.RIGHT}
	});
	let blue = new VS3D.Prop({
		hand: {a: VS3D.RIGHT},
		head: {a: VS3D.LEFT}
	});
	function getPosition(poi)
	{
		let radius = poi.prop.hand.r;
		let hand = poi.prop.hand.a;
		let head = poi.prop.head.a;
		if (nearly(radius, 0))
		{
			if (angle$nearly(head, RIGHT))
			{
				return "p2b";
			}
			else
			{
				return "p2a";
			}
		}
		else if (angle$nearly(hand, RIGHT))
		{
			if (angle$nearly(head, RIGHT))
			{
				return "p3b";
			}
			else
			{
				return "p3a";
			}
		}
		else
		{
			if (angle$nearly(head, RIGHT))
			{
				return "p1b";
			}
			else
			{
				return "p1a";
			}
		}
	}
	function getMove(p1, p2)
	{
		let arr = moves[p1][p2];
		let i = parseInt(Math.random()*arr.length);
		return arr[i];
	}
	function init() {	
		renderer = new VS3D.ThreeRenderer(document.getElementById("display"));
		player = new VS3D.Player();
		let controls = new VS3D.Controls(player);
		renderer.div.appendChild(controls.div);
		red = player.addProp(red,{model: "poi"});
		blue = player.addProp(blue,{model: "poi", color: "blue"});
		red.moves.push(getMove("p3b","p3a"));
		red.moves.push(getMove("p3a","p1b"));
		red.moves.push(getMove("p1b","p3a"));
		red.moves.push(getMove("p3a","p3b"));

		blue.moves.push(getMove("p3a","p1b"));
		blue.moves.push(getMove("p1b","p1a"));	
		blue.moves.push(getMove("p1a","p1b"));
		blue.moves.push(getMove("p1b","p3a"));

		player.update = function(positions) {
			renderer.render(this.props, positions);
			controls.update(this.tick);
		}
		player.ready();
		//player.play();
	}
</script>
<body onload="init();">
	<div id="display">
	</div>
</body>
</html>

