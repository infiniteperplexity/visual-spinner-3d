<!--Distributed under GNU Public License version 3-->
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>VisualSpinner3D Demo, by Glenn Wright</title>
<style>
	#grid1 {
        display: grid;
        grid-column-gap: 3px;
        grid-row-gap: 3px;
        grid-template-rows: 400px auto;
        grid-template-columns: 400px auto;
     }
     #grid2 {
        display: grid;
        grid-template-rows: auto auto auto auto auto;
        grid-template-columns: auto auto auto auto auto;
     }
     #grid3 {
        display: grid;

        grid-template-rows: auto auto auto auto auto auto auto auto;
        grid-template-columns: auto;
     }
</style>
</head>
<script src="vs3d.js"></script>
<script src="vs3d-moves.js"></script>
<script src="three.min.js"></script>
<script src="vs3d-render.js"></script>
<script>
	let renderer, player, red, blue, green, yellow;

	let defaults = {
		model: ["poi","poi","poi","poi"],
		plane: ["WALL","WALL","WALL","WALL"],
		align: ["DOWN","DOWN","UP","UP"],
		orient: ["UP","UP","UP","UP"],
		direction: ["CW","CCW","CCW","CCW"],
		move: ["pendulum","pendulum","isobend4","isobend4"]
	};

	let menus = {
		models: [
			{txt: "None", value: "none"},
			{txt: "Poi", value: "poi"},
			{txt: "Staff", value: "staff"},
			{txt: "Hoop", value: "hoop"},
			{txt: "Fan", value: "fan"}
		],
		planes: [
			{txt: "Wall", value: "WALL"},
			{txt: "Wheel", value: "WHEEL"},
			{txt: "Floor", value: "FLOOR"}
		],
		aligns: [
			{txt: "Up", value: "UP"},
			{txt: "Right", value: "RIGHT"},
			{txt: "Down", value: "DOWN"},
			{txt: "Left", value: "LEFT"}
		],
		orients: [
			{txt: "Up", value: "UP"},
			{txt: "Right", value: "RIGHT"},
			{txt: "Down", value: "DOWN"},
			{txt: "Left", value: "LEFT"}
		],
		directions: [
			{txt: "Clockwise", value: "CW"},
			{txt: "Counter", value: "CCW"}
		],
		moves: [
			// {txt: "Static Spin", value: "static"},
			{txt: "Extension", value: "extension"},
			{txt: "One-Petal In-Spin Flower", value: "inspin1"},
			{txt: "Two-Petal In-Spin Flower", value: "inspin2"},
			{txt: "Four-Petal In-Spin Flower", value: "inspin4"},
			{txt: "Two-Petal Anti-Spin Flower", value: "antispin2"},
			{txt: "Three-Petal Anti-Spin Flower", value: "antispin3"},
			{txt: "Four-Petal Anti-Spin Flower", value: "antispin4"},
			{txt: "Three-Petal Anti-Spin Flower", value: "antispin4"},
			{txt: "Pendulum", value: "pendulum"},
			// 1.5
			{txt: "Iso-Bend Toroid", value: "isobend4"},
			{txt: "Anti-Bend Toroid", value: "antibend4"},
			{txt: "Pro-Bend Toroid", value: "probend2"},
			{txt: "Iso-Bend Toroid (Backward)", value: "isobend-4"},
			{txt: "Anti-Bend Toroid (Backward)", value: "antibend-4"},
			{txt: "Pro-Bend Toroid (Backward)", value: "probend-2"}				// ,
			// {txt: "1.5", value: "1.5"}		
		]
	};

	function init() {
		//hideDebugger();
		setupPlayer();
		setupMenus();
		setMoves();
		play();

	}

	function hideDebugger() {
		document.getElementById("debugger").style.display = "none";
	}

	function play() {
		//player.play();
	}

	function setupPlayer() {
		renderer = new VS3D.ThreeRenderer(document.getElementById("display"));
		player = new VS3D.Player();
		red = new VS3D.Prop();
		blue = new VS3D.Prop();
		green = new VS3D.Prop();
		yellow = new VS3D.Prop();
		player.addProp(yellow, {color: "yellow"});
		player.addProp(green, {color: "green"});
		player.addProp(blue, {color: "blue"});
		player.addProp(red);
		player.render = function(props, positions) {
			renderer.render(props, positions);
		}
		player.reset();
	}

	function setupMenus() {
		for (let i=0; i<4; i++) {
			let prop = [red, blue, green, yellow][i];
			for (let title in menus) {
				let menu = menus[title];
				let name = title.slice(0,title.length-1);
				let node = document.getElementById(name+i);

				node.onchange = setMoves;
				for (let choice of menu) {
					let o = document.createElement("option");
					for (let arg in choice) {
						o[arg] = choice[arg];
					}
					if (defaults[name][i]===o.value) {
						o.selected = true;
					}
					let txt = document.createTextNode(choice.txt);
					o.appendChild(txt);
					node.appendChild(o);
				}
			}
		}
	}

	function shuffleMenus() {
		for (let i=0; i<4; i++) {
			let prop = [red, blue, green, yellow][i];
			for (let title in menus) {
				let menu = menus[title];
				let name = title.slice(0,title.length-1);
				let node = document.getElementById(name+i);
				// menu is the array
				let r = Math.floor(Math.random()*menu.length);
				node.value = menu[r].value;
				// if (name==="move") {
				// 	node.value = "pendulum";
				// }
			}
		}
		setMoves();
	}

	function setMoves() {
		for (let i=0; i<4; i++) {
			let model = document.getElementById("model"+i).value;
			let plane = document.getElementById("plane"+i).value;
			let align = document.getElementById("align"+i).value;
			let direction = document.getElementById("direction"+i).value;
			let recipe = document.getElementById("move"+i).value;
			let prop = player.props[3-i];
			if (prop.model!==model) {
				prop = new VS3D.PropWrapper(prop.prop, {color: prop.color, model: model});
				player.props[3-i] = prop;
				if (i===3) {
					red = prop;
				} else if (i===2) {
					blue = prop;
				} else if (i===1) {
					green = prop;
				} else if (i===0) {
					yellow = prop;
				}
			}
			let move;
			let dir = VS3D[direction];
			let angle = VS3D[align];
			let p = VS3D[plane];
			let start = VS3D.snapto({hand: {a: angle}, head: {a: angle}, p:p});
			if (recipe==="extension") {
				move = {recipe: "flower", orient: angle, petals: 0, direction: dir, p: p};
			} else if (recipe==="inspin1") {
				move = {recipe: "flower", orient: angle, petals: 1, direction: dir, p: p};
			} else if (recipe==="inspin2") {
				move = {recipe: "flower", orient: angle, petals: 2, direction: dir, p: p};
			} else if (recipe==="inspin4") {
				move = {recipe: "flower", orient: angle, petals: 4, direction: dir, p: p};
			} else if (recipe==="antispin2") {
				move = {recipe: "flower", orient: angle, petals: 2, spin: -1, direction: dir, p: p};
			} else if (recipe==="antispin3") {
				move = {recipe: "flower", orient: angle, petals: 3, spin: -1, direction: dir, p: p};
			} else if (recipe==="antispin4") {
				move = {recipe: "flower", orient: angle, petals: 4, spin: -1, direction: dir, p: p};
			} else if (recipe==="isobend2") {
				move = {recipe: "shim_toroid", orient: angle, bend: 1, harmonics: 2, direction: dir, p: p};
			} else if (recipe==="isobend4") {
				move = {recipe: "shim_toroid", orient: angle, bend: 1, harmonics: 4, direction: dir, p: p};
			} else if (recipe==="antibend2") {
				move = {recipe: "shim_toroid", orient: angle, bend: -1, harmonics: 2, direction: dir, p: p};
			} else if (recipe==="antibend4") {
				move = {recipe: "shim_toroid", orient: angle, bend: -1, harmonics: 4, direction: dir, p: p};
			} else if (recipe==="probend2") {
				move = {recipe: "shim_toroid", orient: angle, bend: 3, harmonics: 2, direction: dir, p: p};
			} else if (recipe==="probend4") {
				move = {recipe: "shim_toroid", orient: angle, bend: 3, harmonics: 4, direction: dir, p: p};
			} else if (recipe==="isobend-2") {
				move = {recipe: "shim_toroid", orient: angle, bend: 1, harmonics: -2, direction: dir, p: p};
			} else if (recipe==="isobend-4") {
				move = {recipe: "shim_toroid", orient: angle, bend: 1, harmonics: -4, direction: dir, p: p};
			} else if (recipe==="antibend-2") {
				move = {recipe: "shim_toroid", orient: angle, bend: -1, harmonics: -2, direction: dir, p: p};
			} else if (recipe==="antibend-4") {
				move = {recipe: "shim_toroid", orient: angle, bend: -1, harmonics: -4, direction: dir, p: p};
			} else if (recipe==="probend-2") {
				move = {recipe: "shim_toroid", orient: angle, bend: 3, harmonics: -2, direction: dir, p: p};
			} else if (recipe==="probend-4") {
				move = {recipe: "shim_toroid", orient: angle, bend: 3, harmonics: -4, direction: dir, p: p};
			} else if (recipe==="pendulum") {
				if (align==="UP") {
					//!!!! It should not be necessary to pass the hand argument...bug in snapto
					start = VS3D.snapto(start, {hand: {a: VS3D.UP}, head: {a: VS3D.DOWN}, p: p});
				}
				move = {recipe: "shim_pendulum", direction: dir, p: p};
			}
			prop.prop = start;
			prop.moves[0] = move;
		}
		player.update();
	}


</script>
<body onload="init();">
<a href="https://github.com/infiniteperplexity/visual-spinner-3d">See more at the VisualSpinner3D main site.</a>
<div id="grid1">
	<div id="display"></div>
	<div>
		<div id="grid2">
			<p>Props:</p>
			<select id="model0"></select>
			<select id="model1"></select>
			<select id="model2"></select>
			<select id="model3"></select>
			<p>Planes:</p>
			<select id="plane0"></select>
			<select id="plane1"></select>
			<select id="plane2"></select>
			<select id="plane3"></select>
			<p>Entry:</p>
			<select id="align0"></select>
			<select id="align1"></select>
			<select id="align2"></select>
			<select id="align3"></select>
			<p>Orient:</p>
			<select id="orient0"></select>
			<select id="orient1"></select>
			<select id="orient2"></select>
			<select id="orient3"></select>
			<p>Spin:</p>
			<select id="direction0"></select>
			<select id="direction1"></select>
			<select id="direction2"></select>
			<select id="direction3"></select>
		</div>
		<div id="grid3">
			<p>First Move:</p>
			<select id="move0"></select>
			<p>Second Move:</p>
			<select id="move1"></select>
			<p>Third Move:</p>
			<select id="move2"></select>
			<p>Fourth Move:</p>
			<select id="move3"></select>
		</div>
	</div>
	<div>
		<p>https://github.com/infiniteperplexity/visual-spinner-3d</p>
		<p>infinite DOT perplexity AT gmail DOT com</p>
		<button id="debugger" onclick="shuffleMenus();">debug</button>
	</div>
</div>
</body>
</html>
