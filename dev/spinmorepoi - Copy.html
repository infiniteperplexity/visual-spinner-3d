<!--Distributed under GNU Public License version 3-->
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>VisualSpinner3D Demo, by Glenn Wright</title>
<style>
	#grid1 {
		width: 800px;
        display: grid;
        grid-column-gap: 3px;
        grid-row-gap: 3px;
        grid-template-rows: 400px auto;
        grid-template-columns: 400px auto;
     }
     #grid2 {
        display: grid;
        grid-template-rows: auto auto auto auto auto;
        grid-template-columns: auto auto auto auto auto;
     }
     #grid3 {
        display: grid;

        grid-template-rows: auto auto auto auto auto auto auto auto;
        grid-template-columns: auto;
     }
</style>
</head>
<script src="vs3d.js"></script>
<script src="vs3d-moves.js"></script>
<script src="three.min.js"></script>
<script src="vs3d-render.js"></script>
<script>
	let debug = VS3D.debug;
	let renderer, player;
	let defaults = {
		model: ["poi","poi","poi","poi"],
		plane: ["WALL","WALL","WALL","WALL"],
		align: ["UP","UP","UP","UP"],
		orient: ["UP","UP","UP","UP"],
		direction: ["CW","CW","CCW","CCW"],
		move: ["extension","antispin3","extension","antispin3"]
	};

	let menus = {
		models: [
			{txt: "None", value: "none"},
			{txt: "Poi", value: "poi"},
			{txt: "Staff", value: "staff"},
			{txt: "Hoop", value: "hoop"},
			{txt: "Fan", value: "fan"}
		],
		planes: [
			{txt: "Wall", value: "WALL"},
			{txt: "Wheel", value: "WHEEL"},
			{txt: "Floor", value: "FLOOR"}
		],
		aligns: [
			{txt: "Up", value: "UP"},
			{txt: "Right", value: "RIGHT"},
			{txt: "Down", value: "DOWN"},
			{txt: "Left", value: "LEFT"}
		],
		orients: [
			{txt: "Up", value: "UP"},
			{txt: "Right", value: "RIGHT"},
			{txt: "Down", value: "DOWN"},
			{txt: "Left", value: "LEFT"}
		],
		directions: [
			{txt: "Clockwise", value: "CW"},
			{txt: "Counter", value: "CCW"}
		],
		moves: [
			{txt: "Extension", value: "extension"},
			{txt: "Point Isolation", value: "pointiso"},
			{txt: "One-Petal In-Spin Flower", value: "inspin1"},
			{txt: "Two-Petal In-Spin Flower", value: "inspin2"},
			{txt: "Four-Petal In-Spin Flower", value: "inspin4"},
			{txt: "Four-Petal In-Spin Flower (Box)", value: "inspin4b"},
			{txt: "Two-Petal Anti-Spin Flower", value: "antispin2"},
			{txt: "Three-Petal Anti-Spin Flower", value: "antispin3"},
			{txt: "Four-Petal Anti-Spin Flower", value: "antispin4"},
			{txt: "Four-Petal Anti-Spin Flower (Box)", value: "antispin4b"},
			{txt: "C-CAP (Inspin First)", value: "capin"},
			{txt: "C-CAP (Antispin First)", value: "capanti"},
			{txt: "Isolation", value: "iso"},
			{txt: "Half Extension", value: "hext"},
			{txt: "Cat Eye", value: "cateye"},
			{txt: "Linear Extension", value: "lext"},
			{txt: "Linear Isolation", value: "liso"},
			{txt: "Pendulum", value: "pendulum"},
			{txt: "1.5", value: "1.5"},
			{txt: "Iso-Bend Toroid", value: "isobend4"},
			{txt: "Anti-Bend Toroid", value: "antibend4"},
			{txt: "Pro-Bend Toroid", value: "probend2"},
			{txt: "Iso-Bend Toroid (Backward)", value: "isobend-4"},
			{txt: "Anti-Bend Toroid (Backward)", value: "antibend-4"},
			{txt: "Pro-Bend Toroid (Backward)", value: "probend-2"}
		]
	};

	function init() {
		//hideDebugger();
		setupPlayer();
		setupMenus();
		setMoves();
		play();

	}

	function hideDebugger() {
		document.getElementById("debugger").style.display = "none";
	}

	function play() {
		//player.play();
	}

	function setupPlayer() {
		renderer = new VS3D.ThreeRenderer(document.getElementById("display"));
		player = new VS3D.Player();
		player.addProp(new VS3D.Prop(), {color: "red", nudged: 0.15});
		player.addProp(new VS3D.Prop(), {color: "blue", nudged: 0.10});
		player.addProp(new VS3D.Prop(), {color: "green", nudged: 0.05});
		player.addProp(new VS3D.Prop(), {color: "yellow", nudged: 0.0});
		player.render = function(props, positions) {
			renderer.render(props, positions);
		}
		player.reset();
	}

	function setupMenus() {
		for (let i=0; i<4; i++) {
			let prop = player.props[i].prop;
			for (let title in menus) {
				let menu = menus[title];
				let name = title.slice(0,title.length-1);
				let node = document.getElementById(name+i);

				node.onchange = setMoves;
				for (let choice of menu) {
					let o = document.createElement("option");
					for (let arg in choice) {
						o[arg] = choice[arg];
					}
					if (defaults[name][i]===o.value) {
						o.selected = true;
					}
					let txt = document.createTextNode(choice.txt);
					o.appendChild(txt);
					node.appendChild(o);
				}
			}
		}
	}

	function shuffleMenus() {
		for (let i=0; i<4; i++) {
			let prop = player.props[i];
			for (let title in menus) {
				if (title==="models") {
					continue;
				}
				let menu = menus[title];
				let name = title.slice(0,title.length-1);
				let node = document.getElementById(name+i);
				// menu is the array
				let r = Math.floor(Math.random()*menu.length);
				node.value = menu[r].value;
				// if (name==="move") {
				// 	node.value = "pendulum";
				// }
			}
		}
		setMoves();
	}

	function setMoves() {
		for (let i=0; i<4; i++) {
			let model = document.getElementById("model"+i).value;
			let plane = document.getElementById("plane"+i).value;
			let align = document.getElementById("align"+i).value;
			let oriented = document.getElementById("orient"+i).value;
			let direction = document.getElementById("direction"+i).value;
			let recipe = document.getElementById("move"+i).value;
			let prop = player.props[i];
			if (prop.model!==model) {
				prop = new VS3D.PropWrapper(prop.prop, {color: prop.color, model: model, nudged: prop.nudged});
				player.props[i] = prop;
			}
			let move;
			let dir = VS3D[direction];
			let angle = VS3D[align];
			let orient = VS3D[oriented];
			let p = VS3D[plane];
			let start = VS3D.snapto({hand: {a: angle}, head: {a: angle}, p: p});
			let SPLIT = VS3D.SPLIT;
			prop.setHeadAngle(angle, p);
			prop.setHandAngle(angle, p);
			if (recipe==="extension") {
				move = {recipe: "flower", orient: orient, petals: 0, direction: dir, p: p};
			} else if (recipe==="pointiso") {
				prop.setHeadAngle(angle+SPLIT,p);
				move = {recipe: "flower", orient: orient, petals: 0, direction: dir, p: p};
			} else if (recipe==="inspin1") {
				if (angle===orient+SPLIT) {
					prop.setHeadAngle(angle+SPLIT)
				}
				move = {recipe: "flower", orient: orient, petals: 1, direction: dir, p: p};
			} else if (recipe==="inspin2") {
				move = {recipe: "flower", orient: orient, petals: 2, direction: dir, p: p};
			} else if (recipe==="inspin4") {
				move = {recipe: "flower", orient: orient, petals: 4, direction: dir, p: p};
			} else if (recipe==="inspin4b") {
				prop.setHeadAngle(angle+SPLIT,p);
				move = {recipe: "flower", orient: orient, petals: 4, direction: dir, p: p};
			} else if (recipe==="antispin2") {
				move = {recipe: "flower", orient: orient, petals: 2, spin: -1, direction: dir, p: p};
			} else if (recipe==="antispin3") {
				move = {recipe: "flower", orient: orient, petals: 3, spin: -1, direction: dir, p: p};
			} else if (recipe==="antispin4") {
				move = {recipe: "flower", orient: orient, petals: 4, spin: -1, direction: dir, p: p};
			} else if (recipe==="antispin4b") {
				prop.setHeadAngle(angle+VS3D.SPLIT,p);
				move = {recipe: "flower", orient: orient, petals: 4, spin: -1, direction: dir, p: p};
			} else if (recipe==="capin") {
				move = {recipe: "ccap", orient: orient, direction: dir, p: p};
			} else if (recipe==="capanti") {
				move = {recipe: "ccap", spin: -1, orient: orient, direction: dir, p: p};
			} else if (recipe==="iso") {
				// prop.setHeadAngle(angle+VS3D.SPLIT, p);
				// prop.setHandRadius(0.5);
				move = {recipe: "isolation", orient: orient, direction: dir, p: p};
			} else if (recipe==="cateye") {
				// prop.setHeadAngle(angle+VS3D.SPLIT, p);
				// prop.setHandRadius(0.5);
				move = {recipe: "isolation", direction: dir, orient: orient, spin: -1, p: p};
			} else if (recipe==="hext") {
				// prop.setHandRadius(0.5);;
				move = {recipe: "isolation", direction: dir, p: p};
			} else if (recipe==="lext") {
				move = {recipe: "snake", orient: orient, direction: dir, p: p};
			} else if (recipe==="liso") {
				move = {recipe: "snake", orient: orient, harmonics: 3, ovalness: 0.5, direction: dir, p: p};
			} else if (recipe==="isobend2") {
				move = {recipe: "toroid", orient: orient, bend: 1, harmonics: 2, direction: dir, p: p};
			} else if (recipe==="isobend4") {
				move = {recipe: "toroid", orient: orient, bend: 1, harmonics: 4, direction: dir, p: p};
			} else if (recipe==="antibend2") {
				move = {recipe: "toroid", orient: orient, bend: -1, harmonics: 2, direction: dir, p: p};
			} else if (recipe==="antibend4") {
				move = {recipe: "toroid", orient: orient, bend: -1, harmonics: 4, direction: dir, p: p};
			} else if (recipe==="probend2") {
				move = {recipe: "toroid", orient: orient, bend: 3, harmonics: 2, direction: dir, p: p};
			} else if (recipe==="probend4") {
				move = {recipe: "toroid", orient: orient, bend: 3, harmonics: 4, direction: dir, p: p};
			} else if (recipe==="isobend-2") {
				move = {recipe: "toroid", orient: orient, bend: 1, harmonics: -2, direction: dir, p: p};
			} else if (recipe==="isobend-4") {
				move = {recipe: "toroid", orient: orient, bend: 1, harmonics: -4, direction: dir, p: p};
			} else if (recipe==="antibend-2") {
				move = {recipe: "toroid", orient: orient, bend: -1, harmonics: -2, direction: dir, p: p};
			} else if (recipe==="antibend-4") {
				move = {recipe: "toroid", orient: orient, bend: -1, harmonics: -4, direction: dir, p: p};
			} else if (recipe==="probend-2") {
				move = {recipe: "toroid", orient: orient, bend: 3, harmonics: -2, direction: dir, p: p};
			} else if (recipe==="probend-4") {
				move = {recipe: "toroid", orient: orient, bend: 3, harmonics: -4, direction: dir, p: p};
			} else if (recipe==="pendulum") {
				if (VS3D.angle$nearly(angle, orient-VS3D.SPLIT)) {
					prop.setHeadAngle(orient, p);
				}
				move = {recipe: "pendulum", orient: orient, direction: dir, p: p};
			} else if (recipe==="1.5") {
				move = {recipe: "pendulum", orient: orient, onepointfive: true, direction: dir, p: p};
			};
			move.nofit = true;
			prop.moves[0] = move;
		}
		player.update();
	}


</script>
<body onload="init();">
<a href="https://github.com/infiniteperplexity/visual-spinner-3d">See more at the VisualSpinner3D main site.</a>
<div id="grid1">
	<div id="display"></div>
	<div>
		<div id="grid2">
			<p>Props:</p>
			<select id="model0"></select>
			<select id="model1"></select>
			<select id="model2"></select>
			<select id="model3"></select>
			<p>Planes:</p>
			<select id="plane0"></select>
			<select id="plane1"></select>
			<select id="plane2"></select>
			<select id="plane3"></select>
			<p>Entry:</p>
			<select id="align0"></select>
			<select id="align1"></select>
			<select id="align2"></select>
			<select id="align3"></select>
			<p>Orient:</p>
			<select id="orient0"></select>
			<select id="orient1"></select>
			<select id="orient2"></select>
			<select id="orient3"></select>
			<p>Spin:</p>
			<select id="direction0"></select>
			<select id="direction1"></select>
			<select id="direction2"></select>
			<select id="direction3"></select>
		</div>
		<div id="grid3">
			<p>First Move:</p>
			<select id="move0"></select>
			<p>Second Move:</p>
			<select id="move1"></select>
			<p>Third Move:</p>
			<select id="move2"></select>
			<p>Fourth Move:</p>
			<select id="move3"></select>
		</div>
	</div>
	<div>
		<p>https://github.com/infiniteperplexity/visual-spinner-3d</p>
		<p>infinite DOT perplexity AT gmail DOT com</p>
		<button id="debugger" onclick="shuffleMenus();">debug</button>
	</div>
</div>
</body>
</html>
