<!--Distributed under GNU Public License version 3-->
<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>VisualSpinner3D v. 1.1, by Glenn Wright</title>
<script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
<script src="scripts/gl-matrix-min.js"></script>
<script src="scripts/phoria-min.js"></script>
<script src="scripts/requestAnimationFrame.js"></script>
<script src="scripts/visual-spinner-engine.js"></script>
<script src="scripts/visual-spinner-moves.js"></script>
<script src="scripts/visual-spinner-renderers.js"></script><script>
// set parameters

var HEIGHT = 400;
var WIDTH = 400;
var ORIGINX = WIDTH/2;
var ORIGINY = HEIGHT/2;
var BACKGROUND = "black";


var myProps = new Array(); 
var controller = new Controller();
var moves = new MoveFactory();

$.urlParam = function(name){
	var results = new RegExp('[\\?&]' + name + '=([^&#]*)').exec(window.location.href);
	if (!results) {return 0;}
	return results[1] || 0;
}
		
function init() {
	ctx=document.getElementById('canvas').getContext('2d');
	// optionally, pull parameters from URL
	var params = [	"1prop","2prop","3prop","4prop",
			"2hands","3hands","4hands",
			"2props","3props","4props",
			"2spins","3spins","4spins",
			"1move","2move","3move","4move"];
	var defaults = ["poi","poi","poi","poi",
			"same","same","same",
			"same","same","same",
			"opps","same","opps",
			"xtsn","xtsn","3paf","3paf"];
	for (var i = 0; i<params.length; i++) {
		var txt = $.urlParam(params[i]);
		if (txt==0) {txt = defaults[i];}
		$("#"+params[i]).val(txt);
	}		
	canvasSetup();
	canvasLoop();
}

var scene;
var renderer;
function canvasSetup() {
	canvas.height = HEIGHT;
	canvas.width = WIDTH;
	ctx.fillStyle = BACKGROUND;
	ctx.strokeStyle=BACKGROUND;
	ctx.fillRect(0,0,WIDTH,HEIGHT);
	
	// set up Phoria scene for 3D rendering
	scene = new Phoria.Scene();
	scene.camera.position = {x:0.0, y:1.0, z:10.0};
	scene.perspective.aspect = canvas.width / canvas.height;
	scene.viewport.width = canvas.width;
	scene.viewport.height = canvas.height;
	renderer = new Phoria.CanvasRenderer(canvas);
	var plane = Phoria.Util.generateTesselatedPlane(8,8,0,20);
	scene.graph.push(Phoria.Entity.create({
		points: plane.points,
		edges: plane.edges,
		polygons: plane.polygons,
		style: {
				 drawmode: "wireframe",
				 shademode: "plain",
				 linewidth: 0.5,
				 objectsortmode: "back"
			}}));
	scene.graph.push(new Phoria.DistantLight());
	var light = new Phoria.DistantLight();
	light.direction.x = 1;
	light.direction.z = 0;
	scene.graph.push(light);
	light = new Phoria.DistantLight();
	light.direction.y = 1;
	light.direction.z = 0;
	scene.graph.push(light);
	// set up props
	var propOne = new Prop(new Poi());
	var propTwo = new Prop(new Poi());
	var propThree = new Prop(new Poi());
	var propFour = new Prop(new Poi());
	propTwo.renderer.head_color_3d = [0,0,255];
	propThree.renderer.head_color_3d = [255,255,0];
	propFour.renderer.head_color_3d = [0,255,0];
	myProps.push(propOne);
	myProps.push(propTwo);
	myProps.push(propThree);
	myProps.push(propFour);
	// set up controller	
	controller.updateParameters();
}
	
// animation loop
function canvasLoop() {
	setTimeout(function() {
		requestAnimationFrame(canvasLoop);
		redraw();
		for (var i = 0; i < myProps.length; i++) {
			myProps[i].spin();
			myProps[i].render3D();
		}
	},1000/BEAT);
}
function redraw() {
	scene.modelView();
	renderer.render(scene);
}

function Controller() {
	this.handDir = [CLOCKWISE,CLOCKWISE];
	this.propAng = [TWELVE,SIX];
	this.handAng = [TWELVE,SIX];		
}
Controller.prototype.queueIsEmpty = function() {
	this.updateParameters();
}
var prevr = Array(myProps.length);
Controller.prototype.updateParameters = function() {
	var list;
	var txt;
	var renderer;
	var move;
	var propn;
	
	//Update prop types
	for(var i = 1; i<=myProps.length; i++) {
		list = document.getElementById(i+"prop");
		txt = list.options[list.selectedIndex].value;
		if (prevr[i-1]!==txt) {
			if (txt=="poi") {
				renderer = new Poi();
			} else if (txt=="none") {
				renderer = new NoProp();
			}
			renderer.head_color_3d = myProps[i-1].renderer.head_color_3d;			
			myProps[i-1].renderer.deactivate();
			myProps[i-1].renderer = renderer;
			renderer.prop = myProps[i-1];
			renderer.activate();
		}
	}		
	//Update  hand and prop relationships
	this.propAng[0] = TWELVE;
	this.handAng[0] = TWELVE;
	this.handDir[0] = CLOCKWISE;
	for (var i = 2; i<=myProps.length; i++) {
		list = document.getElementById(i+"props");
		txt = list.options[list.selectedIndex].value;
		if (txt=="same") {
			this.propAng[i-1] = TWELVE;
		} else if (txt=="splt") {
			this.propAng[i-1] = SIX;
		} else if (txt=="qrtr") {
			this.propAng[i-1] = THREE;
		} else if (txt=="sqrt") {
			this.propAng[i-1] = NINE;
		}
		list = document.getElementById(i+"hands");
		txt = list.options[list.selectedIndex].value;
		if (txt=="same") {
			this.handAng[i-1] = TWELVE;
		} else if (txt=="splt") {
			this.handAng[i-1] = SIX;
		} else if (txt=="qrtr") {
			this.handAng[i-1] = THREE;
		} else if (txt=="sqrt") {
			this.handAng[i-1] = NINE;
		}
		list = document.getElementById(i+"spins");
		txt = list.options[list.selectedIndex].value;
		if (txt=="same") {
			this.handDir[i-1] = CLOCKWISE;
		} else if (txt=="opps") {
			this.handDir[i-1] = COUNTERCLOCKWISE;
		}
	}	
	//Generate moves
	var submoves;
	for (var i = 1; i<=myProps.length; i++) {
		list = document.getElementById(i+"move");
		txt = list.options[list.selectedIndex].value;
		move = this.generateMove(i-1,txt);
		move.isOneShot = true;		
		move.align.hand.angle = this.handAng[i-1];
		move.align.hand.plane = WALL;
		move.align.prop.angle = this.propAng[i-1];
		move.align.prop.plane = WALL;
		submoves = myProps[i-1].getMoveQueue().getSubMoves();
		while (submoves.length > 1) {
			submoves.pop();
		}
		myProps[i-1].addMove(move);
	}
	var linktxt = "http://infiniteperplexity.github.io/visual-spinner-3d/";
	var params = [	"1prop","2prop","3prop","4prop",
			"2hands","3hands","4hands",
			"2props","3props","4props",
			"2spins","3spins","4spins",
			"1move","2move","3move","4move"];
	for (var i = 0; i<params.length; i++) {
		if (i==0) {
			linktxt += "?" + params[i] + "=" + $("#"+params[i]).val();
		} else {
			linktxt += "&" + params[i] + "=" + $("#"+params[i]).val();
		}
	}
	$('#myLink').text(linktxt);
}


Controller.prototype.generateMove = function(n, txt) {
	var move;
	if (txt=="stat") {
		move = moves.staticspin({direction: this.handDir[n]});
	} else if (txt=="xtsn") {
		move = moves.flower({direction: this.handDir[n], petals: 0});
	} else if (txt=="1pif") {
		move = moves.flower({direction: this.handDir[n], petals: 1});
	} else if (txt=="2pif") {
		move = moves.flower({direction: this.handDir[n], petals: 2});
	} else if (txt=="4pif") {
		move = moves.flower({direction: this.handDir[n]});
	} else if (txt=="3paf") {
		move = move = moves.flower({direction: this.handDir[n], spin: ANTISPIN, petals: 3});
	} else if (txt=="4paf") {
		move = move = moves.flower({direction: this.handDir[n], spin: ANTISPIN});
	} else if (txt=="hcap") {
		move = moves.ccap({direction: this.handDir[n]});
	} else if (txt=="vcap") {
		move = moves.ccap({direction: this.handDir[n]});
		move.changePhase(1);
	} else if (txt=="hcpo") {
		move = moves.ccap({direction: -this.handDir[n]});
		move.changePhase(2);
	} else if (txt=="vcpo") {
		move = moves.ccap({direction: -this.handDir[n]});
		move.changePhase(3);
	} else if (txt=="pend") {
		move = moves.pendulum({direction: this.handDir[n]});
	} else if (txt=="1pt5") {
		move = moves.onepointfive({direction: this.handDir[n]});
	} else if (txt=="isol") {
		move = moves.isolation({direction: this.handDir[n]});
	} else if (txt=="cate") {
		move = moves.isolation({direction: this.handDir[n], spin: ANTISPIN});
	} else if (txt=="hlex") {
		move = moves.linex({direction: this.handDir[n], angle: this.handAng[n]+STAGGER});
	} else if (txt=="vlex") {
		move = moves.linex({direction: this.handDir[n], angle: this.handAng[n]});
	} else if (txt=="2btw") {
		move = moves.weave({direction: this.handDir[n]});
	} else if (txt=="3btw") {
		move = moves.weave({beats: 3, direction: this.handDir[n]});
	} else if (txt=="e3bt") {
		move = moves.weave({shape: "circular", extend: 1, beats: 3, direction: this.handDir[n]});
	} else if (txt=="supr") {
		move = moves.superman({direction: this.handDir[n]});
	} else if (txt=="esup") {
		move = moves.superman({shape: "circular", extend: 1, direction: this.handDir[n]});
	} else if (txt=="isob") {
		move = moves.isobend({direction: this.handDir[n]});
	} else if (txt=="antb") {
		move = moves.antibend({direction: this.handDir[n]});
	}
	return move;
}
</script>
<script>try {  for(var lastpass_iter=0; lastpass_iter < document.forms.length; lastpass_iter++){    var lastpass_f = document.forms[lastpass_iter];    if(typeof(lastpass_f.lpsubmitorig)=="undefined"){      if (typeof(lastpass_f.submit) == "function") {        lastpass_f.lpsubmitorig = lastpass_f.submit;        lastpass_f.submit = function(){          var form = this;          try {            if (document.documentElement && 'createEvent' in document)            {              var forms = document.getElementsByTagName('form');              for (var i=0 ; i<forms.length ; ++i)                if (forms[i]==form)                {                  var element = document.createElement('lpformsubmitdataelement');                  element.setAttribute('formnum',i);                  element.setAttribute('from','submithook');                  document.documentElement.appendChild(element);                  var evt = document.createEvent('Events');                  evt.initEvent('lpformsubmit',true,false);                  element.dispatchEvent(evt);                  break;                }            }          } catch (e) {}          try {            form.lpsubmitorig();          } catch (e) {}        }      }    }  }} catch (e) {}</script></head>
<body onload="init();">
<table>
<tbody><tr>
<td rowspan="9" colspan="2">
	<canvas width="400" height="400" id="canvas" style="background-color: #000">
		Your browser doesn't support the HTML5 element canvas.
	</canvas>
</td>
<td>
First Prop:
</td>
<form></form>
<td>
	<select id="1prop" onchange="controller.updateParameters()">
		<option value="poi" selected="selected">Poi</option>
		<option value="none">None</option>
	</select>

</td>

<td>
Third Prop:
</td>
<form></form>
<td>
	<select id="3prop" onchange="controller.updateParameters()">
		<option value="poi" selected="selected">Poi</option>
		<option value="none">None</option>
	</select>
</td>

</tr>
<tr>
<td>
Second Prop:
</td>
<form></form>
<td>
	<select id="2prop" onchange="controller.updateParameters()">
		<option value="poi" selected="selected">Poi</option>
		<option value="none">None</option>
	</select>
</td>

<td>
Fourth Prop:
</td>
<form></form>
<td>
	<select id="4prop" onchange="controller.updateParameters()">
		<option value="poi" selected="selected">Poi</option>
		<option value="none">None</option>
	</select>
</td>
</tr>
<tr>
<td>
Hand Relations:
</td>
<form></form>
<td>
	<select id="2hands" onchange="controller.updateParameters()">
		<option value="same" selected="selected">Same</option>
		<option value="splt">Split</option>
		<option value="qrtr">Quarter</option>
		<option value="sqrt">SpltQrtr</option>
	</select>
</td>
<form></form>
<td>
	<select id="3hands" onchange="controller.updateParameters()">
		<option value="same" selected="selected">Same</option>
		<option value="splt">Split</option>
		<option value="qrtr">Quarter</option>
		<option value="sqrt">SpltQrtr</option>
	</select>
</td>
<form></form>
<td>
	<select id="4hands" onchange="controller.updateParameters()">
		<option value="same" selected="selected">Same</option>
		<option value="splt">Split</option>
		<option value="qrtr">Quarter</option>
		<option value="sqrt">SpltQrtr</option>
	</select>
</td>
</tr>
<tr>
<td>
Prop Relations:
</td>
<form></form>
<td>
	<select id="2props" onchange="controller.updateParameters()">
		<option value="same" selected="selected">Same</option>
		<option value="splt">Split</option>
		<option value="qrtr">Quarter</option>
		<option value="sqrt">SpltQrtr</option>
	</select>
</td>
<td>
	<select id="3props" onchange="controller.updateParameters()">
		<option value="same" selected="selected">Same</option>
		<option value="splt">Split</option>https://github.com/infiniteperplexity/visual-spinner-3d
		<option value="qrtr">Quarter</option>
		<option value="sqrt">SpltQrtr</option>
	</select>
</td>
<td>
	<select id="4props" onchange="controller.updateParameters()">
		<option value="same" selected="selected">Same</option>
		<option value="splt">Split</option>
		<option value="qrtr">Quarter</option>
		<option value="sqrt">SpltQrtr</option>
	</select>
</td>
</tr>
<tr>
<td>
Spin Directions:
</td>
<form></form>
<td>
	<select id="2spins" onchange="controller.updateParameters()">
		<option value="same">Same</option>
		<option value="opps" selected="selected">Opposite</option>
	</select>
</td>
<td>
	<select id="3spins" onchange="controller.updateParameters()">
		<option value="same" selected="selected">Same</option>
		<option value="opps">Opposite</option>
	</select>
</td>
<td>
	<select id="4spins" onchange="controller.updateParameters()">
		<option value="same">Same</option>
		<option value="opps" selected="selected">Opposite</option>
	</select>
</td>
<td></td>
<td></td>
</tr>
<tr>
<td>
First Move:
</td>
<form></form>
<td colspan="3">
	<select id="1move" onchange="controller.updateParameters()">
		<option value="stat">Static Spin</option>
		<option value="xtsn" selected="selected">Extension</option>
		<option value="1pif">One-Petal In-Spin Flower</option>
		<option value="2pif">Two-Petal In-Spin Flower</option>
		<option value="4pif">Four-Petal In-Spin Flower</option>
		<option value="3paf">Three-Petal Anti-Spin Flower</option>
		<option value="4paf">Four-Petal Anti-Spin Flower</option>
		<option value="hcap">Horizontal C-CAP</option>
		<option value="hcpo">Horizontal C-CAP (offset)</option>
		<option value="vcap">Vertical C-CAP</option>
		<option value="vcpo">Vertical C-CAP (offset)</option>
		<option value="pend">Pendulum</option>
		<option value="1pt5">1.5</option>
		<option value="isol">Isolation</option>
		<option value="cate">Cat-Eye</option>
		<option value="hlex">Horizontal Linear Extension</option>
		<option value="vlex">Vertical Linear Extension</option>
		<option value="2btw">Two-Beat Weave</option>
		<option value="3btw">Three-Beat Weave</option>
		<option value="e3bt">Three-Beat Extension</option>
		<option value="supr">Superman</option>
		<option value="esup">Extended Superman</option>
		<option value="isob">Four-Lobe Iso-bend Toroid</option>
		<option value="antb">Four-Lobe Anti-bend Toroid</option>
	</select>
</td>

</tr>
<tr>
<td>
Second Move:
</td>
<form></form>
<td colspan="3">
	<select id="2move" onchange="controller.updateParameters()">
		<option value="stat">Static Spin</option>
		<option value="xtsn" selected="selected">Extension</option>
		<option value="1pif">One-Petal In-Spin Flower</option>
		<option value="2pif">Two-Petal In-Spin Flower</option>
		<option value="4pif">Four-Petal In-Spin Flower</option>
		<option value="3paf">Three-Petal Anti-Spin Flower</option>
		<option value="4paf">Four-Petal Anti-Spin Flower</option>
		<option value="hcap">Horizontal C-CAP</option>
		<option value="hcpo">Horizontal C-CAP (offset)</option>
		<option value="vcap">Vertical C-CAP</option>
		<option value="vcpo">Vertical C-CAP (offset)</option>
		<option value="pend">Pendulum</option>
		<option value="1pt5">1.5</option>
		<option value="isol">Isolation</option>
		<option value="cate">Cat-Eye</option>
		<option value="hlex">Horizontal Linear Extension</option>
		<option value="vlex">Vertical Linear Extension</option>
		<option value="2btw">Two-Beat Weave</option>
		<option value="3btw">Three-Beat Weave</option>
		<option value="e3bt">Three-Beat Extension</option>
		<option value="supr">Superman</option>
		<option value="esup">Extended Superman</option>
		<option value="isob">Four-Lobe Iso-bend Toroid</option>
		<option value="antb">Four-Lobe Anti-bend Toroid</option>
	</select>
</td>
</tr>
<tr>
<td>
Third Move:
</td>
<form></form>
<td colspan="3">
	<select id="3move" onchange="controller.updateParameters()">
		<option value="stat">Static Spin</option>
		<option value="xtsn">Extension</option>
		<option value="1pif">One-Petal In-Spin Flower</option>
		<option value="2pif">Two-Petal In-Spin Flower</option>
		<option value="4pif">Four-Petal In-Spin Flower</option>
		<option selected="selected" value="3paf">Three-Petal Anti-Spin Flower</option>
		<option value="4paf">Four-Petal Anti-Spin Flower</option>
		<option value="hcap">Horizontal C-CAP</option>
		<option value="hcpo">Horizontal C-CAP (offset)</option>
		<option value="vcap">Vertical C-CAP</option>
		<option value="vcpo">Vertical C-CAP (offset)</option>
		<option value="pend">Pendulum</option>
		<option value="1pt5">1.5</option>
		<option value="isol">Isolation</option>
		<option value="cate">Cat-Eye</option>
		<option value="hlex">Horizontal Linear Extension</option>
		<option value="vlex">Vertical Linear Extension</option>
		<option value="2btw">Two-Beat Weave</option>
		<option value="3btw">Three-Beat Weave</option>
		<option value="e3bt">Three-Beat Extension</option>
		<option value="supr">Superman</option>
		<option value="esup">Extended Superman</option>
		<option value="isob">Four-Lobe Iso-bend Toroid</option>
		<option value="antb">Four-Lobe Anti-bend Toroid</option>
	</select>
</td>
</tr>
<tr>
<td>
Fourth Move:
</td>
<form></form>
<td colspan="3">
	<select id="4move" onchange="controller.updateParameters()">
		<option value="stat">Static Spin</option>
		<option value="xtsn">Extension</option>
		<option value="1pif">One-Petal In-Spin Flower</option>
		<option value="2pif">Two-Petal In-Spin Flower</option>
		<option value="4pif">Four-Petal In-Spin Flower</option>
		<option selected="selected" value="3paf">Three-Petal Anti-Spin Flower</option>
		<option value="4paf">Four-Petal Anti-Spin Flower</option>
		<option value="hcap">Horizontal C-CAP</option>
		<option value="hcpo">Horizontal C-CAP (offset)</option>
		<option value="vcap">Vertical C-CAP</option>
		<option value="vcpo">Vertical C-CAP (offset)</option>
		<option value="pend">Pendulum</option>
		<option value="1pt5">1.5</option>
		<option value="isol">Isolation</option>
		<option value="cate">Cat-Eye</option>
		<option value="hlex">Horizontal Linear Extension</option>
		<option value="vlex">Vertical Linear Extension</option>
		<option value="2btw">Two-Beat Weave</option>
		<option value="3btw">Three-Beat Weave</option>
		<option value="e3bt">Three-Beat Extension</option>
		<option value="supr">Superman</option>
		<option value="esup">Extended Superman</option>
		<option value="isob">Four-Lobe Iso-bend Toroid</option>
		<option value="antb">Four-Lobe Anti-bend Toroid</option>
	</select>
</td>
</tr>
</tbody></table>

<p></p>
Pasteable link to these settings:
<p id="myLink">http://infiniteperplexity.github.io/visual-spinner-3d/?1prop=poi&amp;2prop=poi&amp;3prop=poi&amp;4prop=poi&amp;2hands=same&amp;3hands=same&amp;4hands=same&amp;2props=same&amp;3props=same&amp;4props=same&amp;2spins=opps&amp;3spins=same&amp;4spins=opps&amp;1move=xtsn&amp;2move=xtsn&amp;3move=3paf&amp;4move=3paf</p><p></p>
<p>Source: https://github.com/infiniteperplexity/visual-spinner-3d</p>
<p>Questions, comments, and suggestions: infinite DOT perplexity AT gmail DOT com</p>



</body></html>
