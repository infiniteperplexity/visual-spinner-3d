<!--Distributed under GNU Public License version 3-->
<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>VisualSpinner3D v. 1.2, by Glenn Wright</title>
<script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
<script src="scripts/gl-matrix-min.js"></script>
<script src="scripts/phoria-min.js"></script>
<script src="scripts/requestAnimationFrame.js"></script>
<script src="scripts/visual-spinner-engine.js"></script>
<script src="scripts/visual-spinner-moves.js"></script>
<script src="scripts/visual-spinner-renderers.js"></script><script>
// set parameters

var HEIGHT = 400;
var WIDTH = 400;
var ORIGINX = WIDTH/2;
var ORIGINY = HEIGHT/2;
var BACKGROUND = "black";

var myProps = new Array(); 
var controller = new Controller();
var moves = new MoveFactory();

$.urlParam = function(name){
	var results = new RegExp('[\\?&]' + name + '=([^&#]*)').exec(window.location.href);
	if (!results) {return 0;}
	return results[1] || 0;
}
		
function init() {
	ctx=document.getElementById('canvas').getContext('2d');
	// optionally, pull parameters from URL
	var params = [	"1prop","2prop","3prop","4prop",
					"1plane","2plane","3plane","4plane",
					"1hand","2hand","3hand","4hand",
					"1spin","2spin","3spin","4spin",
					"1move","2move","3move","4move"];
	var defaults = ["poi","poi","poi","poi",
					"wall","wall","wall","wall",
					"twelve","twelve","twelve","twelve",
					"cw","ccw","cw","ccw",
					"xtsn","xtsn","3paf","3paf"];
	for (var i = 0; i<params.length; i++) {
		var txt = $.urlParam(params[i]);
		if (txt==0) {txt = defaults[i];}
		$("#"+params[i]).val(txt);
	}		
	canvasSetup();
	canvasLoop();
}


var scene;
var renderer;
function canvasSetup() {
	canvas.height = HEIGHT;
	canvas.width = WIDTH;
	ctx.fillStyle = BACKGROUND;
	ctx.strokeStyle=BACKGROUND;
	ctx.fillRect(0,0,WIDTH,HEIGHT);
	
	// set up Phoria scene for 3D rendering
	scene = new Phoria.Scene();
	scene.camera.position = {x:0.0, y:1.0, z:10.0};
	scene.perspective.aspect = canvas.width / canvas.height;
	scene.viewport.width = canvas.width;
	scene.viewport.height = canvas.height;
	renderer = new Phoria.CanvasRenderer(canvas);
	var plane = Phoria.Util.generateTesselatedPlane(8,8,0,20);
	scene.graph.push(Phoria.Entity.create({
		points: plane.points,
		edges: plane.edges,
		polygons: plane.polygons,
		style: {
				 drawmode: "wireframe",
				 shademode: "plain",
				 linewidth: 0.5,
				 objectsortmode: "back"
			}}));
	scene.graph.push(new Phoria.DistantLight());
	var light = new Phoria.DistantLight();
	light.direction.x = 1;
	light.direction.z = 0;
	scene.graph.push(light);
	light = new Phoria.DistantLight();
	light.direction.y = 1;
	light.direction.z = 0;
	scene.graph.push(light);
	// set up props
	var propOne = new Prop(new Poi());
	var propTwo = new Prop(new Poi());
	var propThree = new Prop(new Poi());
	var propFour = new Prop(new Poi());
	propTwo.renderer.head_color = "blue";
	propThree.renderer.head_color = "yellow";
	propFour.renderer.head_color = "green";
	propTwo.renderer.head_color_3d = [0,0,255];
	propThree.renderer.head_color_3d = [255,255,0];
	propFour.renderer.head_color_3d = [0,255,0];
	myProps.push(propOne);
	myProps.push(propTwo);
	myProps.push(propThree);
	myProps.push(propFour);
	// set up controller	
	controller.updateParameters();
}
	
// animation loop
function canvasLoop() {
	setTimeout(function() {
		requestAnimationFrame(canvasLoop);
		redraw();
		for (var i = 0; i < myProps.length; i++) {
			myProps[i].spin();
			myProps[i].render3D();
		}
	},1000/BEAT);
}
function redraw() {
	scene.modelView();
	renderer.render(scene);
}

function Controller() {
	this.prop = [];
	this.plane = [];
	this.hand = [];
	this.spin = [];
}
Controller.prototype.queueIsEmpty = function() {
	this.updateParameters();
}
Controller.prototype.updateParameters = function() {
	var list;
	var txt;
	var renderer;
	var move;
	var propn;
	
	//Update prop types
	for(var i = 1; i<=myProps.length; i++) {
		list = document.getElementById(i+"prop");
		txt = list.options[list.selectedIndex].value;
		//if this is undefined will it throw an error?
		if (this.prop[i-1]!==txt) {
			this.prop[i-1]=txt;
			if (txt=="poi") {
				renderer = new Poi();
			} else if (txt=="fpoi") {
				renderer = new FirePoi();
			} else if (txt=="none") {
				renderer = new NoProp();
			}
			renderer.head_color_3d = myProps[i-1].renderer.head_color_3d;		
			renderer.head_color = myProps[i-1].renderer.head_color;
			myProps[i-1].renderer.deactivate();
			myProps[i-1].renderer = renderer;
			renderer.prop = myProps[i-1];
			renderer.activate();
		}
	}			
	//Update  hand and prop positions
	for (var i = 1; i<=myProps.length; i++) {
		list = document.getElementById(i+"plane");
		txt = list.options[list.selectedIndex].value;
		if (txt=="wall") {
			this.plane[i-1] = WALL;
		} else if (txt=="wheel") {
			this.plane[i-1] = WHEEL;
		} else if (txt=="floor") {
			this.plane[i-1] = FLOOR;
		}
		list = document.getElementById(i+"hand");
		txt = list.options[list.selectedIndex].value;
		if (txt=="twelve") {
			this.hand[i-1] = TWELVE;
		} else if (txt=="six") {
			this.hand[i-1] = SIX;
		} else if (txt=="three") {
			this.hand[i-1] = THREE;
		} else if (txt=="nine") {
			this.hand[i-1] = NINE;
		}
		list = document.getElementById(i+"spin");
		txt = list.options[list.selectedIndex].value;
		if (txt=="cw") {
			this.spin[i-1] = CLOCKWISE;
		} else if (txt=="ccw") {
			this.spin[i-1] = COUNTERCLOCKWISE;
		}
	}	
	//Generate moves
	var submoves;
	for (var i = 1; i<=myProps.length; i++) {
		list = document.getElementById(i+"move");
		txt = list.options[list.selectedIndex].value;
		move = this.generateMove(i-1,txt);
		move.isOneShot = true;		
		move.align.hand.angle = this.hand[i-1];
		submoves = myProps[i-1].getMoveQueue().getSubMoves();
		while (submoves.length > 1) {
			submoves.pop();
		}
		myProps[i-1].addMove(move);
	}
	var linktxt = "http://infiniteperplexity.github.io/visual-spinner-3d/";
	var params = [	"1prop","2prop","3prop","4prop",
					"1plane","2plane","3plane","4plane",
					"1hand","2hand","3hand","4hand",
					"1spin","2spin","3spin","4spin",
					"1move","2move","3move","4move"];
	for (var i = 0; i<params.length; i++) {
		if (i==0) {
			linktxt += "?" + params[i] + "=" + $("#"+params[i]).val();
		} else {
			linktxt += "&" + params[i] + "=" + $("#"+params[i]).val();
		}
	}
	$('#myLink').text(linktxt);
}


Controller.prototype.generateMove = function(n, txt) {
	var move;
	if (txt=="stat") {
		move = moves.staticspin({direction: this.spin[n], plane: this.plane[n]});
		// or could do this as a 0 offset...
		move.align.prop.angle = this.hand[n];
	} else if (txt=="xtsn") {
		move = moves.flower({direction: this.spin[n], plane: this.plane[n], petals: 0});
	} else if (txt=="1pif") {
		move = moves.flower({direction: this.spin[n], plane: this.plane[n], petals: 1});
	} else if (txt=="2pif") {
		move = moves.flower({direction: this.spin[n], plane: this.plane[n], petals: 2});
	} else if (txt=="4pif") {
		move = moves.flower({direction: this.spin[n], plane: this.plane[n]});
	} else if (txt=="3paf") {
		move = move = moves.flower({direction: this.spin[n], plane: this.plane[n], spin: ANTISPIN, petals: 3});
	} else if (txt=="4paf") {
		move = move = moves.flower({direction: this.spin[n], plane: this.plane[n], spin: ANTISPIN});
	} else if (txt=="hcap") {
		move = moves.ccap({direction: this.spin[n], plane: this.plane[n]});
	} else if (txt=="vcap") {
		move = moves.ccap({direction: this.spin[n], plane: this.plane[n]});
		move.changePhase(1);
	} else if (txt=="hcpo") {
		move = moves.ccap({direction: -this.spin[n], plane: this.plane[n]});
		move.changePhase(2);
	} else if (txt=="vcpo") {
		move = moves.ccap({direction: -this.spin[n], plane: this.plane[n]});
		move.changePhase(3);
	} else if (txt=="pend") {
		move = moves.pendulum({direction: this.spin[n], plane: this.plane[n]});
	} else if (txt=="1pt5") {
		move = moves.onepointfive({direction: this.spin[n], plane: this.plane[n]});
	} else if (txt=="isol") {
		move = moves.isolation({direction: this.spin[n], plane: this.plane[n]});
	} else if (txt=="cate") {
		move = moves.isolation({direction: this.spin[n], plane: this.plane[n], spin: ANTISPIN});
	} else if (txt=="hlex") {
		move = moves.linex({direction: this.spin[n], plane: this.plane[n], angle: this.hand[n]+STAGGER});
	} else if (txt=="vlex") {
		move = moves.linex({direction: this.spin[n], plane: this.plane[n], angle: this.hand[n]});
	} else if (txt=="2btw") {
		move = moves.weave({direction: this.spin[n], plane: this.plane[n]});
	} else if (txt=="supr") {
		move = moves.superman({direction: this.spin[n], hand_plane: this.plane[n]});
	} else if (txt=="isob") {
		move = moves.toroid({lobes: 4, direction: this.spin[n], bend: ISOBEND, plane: this.plane[n]});
	} else if (txt=="antb") {
		move = moves.toroid({lobes: 4, direction: this.spin[n], bend: ANTIBEND, plane: this.plane[n]});
	} else if (txt=="prob") {
		move = moves.toroid({lobes: 4, direction: this.spin[n], bend: PROBEND, plane: this.plane[n]});
	}
	return move;
}
</script>
<body onload="init();">
<table>
<tbody><tr>
<td rowspan="9" colspan="2">
	<canvas width="400" height="400" id="canvas" style="background-color: #000">
		Your browser doesn't support the HTML5 element canvas.
	</canvas>
</td>
<td>
First Prop:
</td>
<form></form>
<td>
	<select id="1prop" onchange="controller.updateParameters()">
		<option value="poi" selected="selected">Poi</option>
		<option value="fpoi">Fire Poi</option>
		<option value="none">None</option>
	</select>

</td>

<td>
Third Prop:
</td>
<form></form>
<td>
	<select id="3prop" onchange="controller.updateParameters()">
		<option value="poi" selected="selected">Poi</option>
		<option value="fpoi">Fire Poi</option>
		<option value="none">None</option>
	</select>
</td>

</tr>
<tr>
<td>
Second Prop:
</td>
<form></form>
<td>
	<select id="2prop" onchange="controller.updateParameters()">
		<option value="poi" selected="selected">Poi</option>
		<option value="fpoi">Fire Poi</option>
		<option value="none">None</option>
	</select>
</td>

<td>
Fourth Prop:
</td>
<form></form>
<td>
	<select id="4prop" onchange="controller.updateParameters()">
		<option value="poi" selected="selected">Poi</option>
		<option value="fpoi">Fire Poi</option>
		<option value="none">None</option>
	</select>
</td>
</tr>
<tr>
<td>
Hand Relations:
</td>
<form></form>
<td>
	<select id="1plane" onchange="controller.updateParameters()">
		<option value="wall" selected="selected">Wall</option>
		<option value="wheel">Wheel</option>
		<option value="floor">Floor</option>
	</select>
</td>
<form></form>
<td>
	<select id="2plane" onchange="controller.updateParameters()">
		<option value="wall" selected="selected">Wall</option>
		<option value="wheel">Wheel</option>
		<option value="floor">Floor</option>
	</select>
</td>
<form></form>
<td>
	<select id="3plane" onchange="controller.updateParameters()">
		<option value="wall" selected="selected">Wall</option>
		<option value="wheel">Wheel</option>
		<option value="floor">Floor</option>
	</select>
</td>
<form></form>
<td>
	<select id="4plane" onchange="controller.updateParameters()">
		<option value="wall" selected="selected">Wall</option>
		<option value="wheel">Wheel</option>
		<option value="floor">Floor</option>
	</select>
</td>
</tr>
<tr>
<td>
Hand Relations:
</td>
<form></form>
<td>
	<select id="1hand" onchange="controller.updateParameters()">
		<option value="twelve" selected="selected">Up</option>
		<option value="six">Down</option>
		<option value="three">Right</option>
		<option value="nine">Left</option>
	</select>
</td>
<form></form>
<td>
	<select id="2hand" onchange="controller.updateParameters()">
		<option value="twelve" selected="selected">Up</option>
		<option value="six">Down</option>
		<option value="three">Right</option>
		<option value="nine">Left</option>
	</select>
</td>
<form></form>
<td>
	<select id="3hand" onchange="controller.updateParameters()">
		<option value="twelve" selected="selected">Up</option>
		<option value="six">Down</option>
		<option value="three">Right</option>
		<option value="nine">Left</option>
	</select>
</td>
<form></form>
<td>
	<select id="4hand" onchange="controller.updateParameters()">
		<option value="twelve" selected="selected">Up</option>
		<option value="six">Down</option>
		<option value="three">Right</option>
		<option value="nine">Left</option>
	</select>
</td>
</tr>
<tr>
<td>
Spin Directions:
</td>
<form></form>
<td>
	<select id="1spin" onchange="controller.updateParameters()">
		<option value="cw" selected="selected">Clockwise</option>
		<option value="ccw">Counterclockwise</option>
	</select>
</td>
<td>
	<select id="2spin" onchange="controller.updateParameters()">
		<option value="cw">Clockwise</option>
		<option value="ccw" selected="selected">Counterclockwise</option>
	</select>
</td>
<td>
	<select id="3spin" onchange="controller.updateParameters()">
		<option value="cw" selected="selected">Clockwise</option>
		<option value="ccw">Counterclockwise</option>
	</select>
</td>
<td>
	<select id="4spin" onchange="controller.updateParameters()">
		<option value="cw">Clockwise</option>
		<option value="ccw" selected="selected">Counterclockwise</option>
	</select>
</td>
<td></td>
<td></td>
</tr>
<tr>
<td>
First Move:
</td>
<form></form>
<td colspan="3">
	<select id="1move" onchange="controller.updateParameters()">
		<option value="stat">Static Spin</option>
		<option value="xtsn" selected="selected">Extension</option>
		<option value="1pif">One-Petal In-Spin Flower</option>
		<option value="2pif">Two-Petal In-Spin Flower</option>
		<option value="4pif">Four-Petal In-Spin Flower</option>
		<option value="3paf">Three-Petal Anti-Spin Flower</option>
		<option value="4paf">Four-Petal Anti-Spin Flower</option>
		<option value="hcap">Horizontal C-CAP</option>
		<option value="hcpo">Horizontal C-CAP (offset)</option>
		<option value="vcap">Vertical C-CAP</option>
		<option value="vcpo">Vertical C-CAP (offset)</option>
		<option value="pend">Pendulum</option>
		<option value="1pt5">1.5</option>
		<option value="isol">Isolation</option>
		<option value="cate">Cat-Eye</option>
		<option value="hlex">Horizontal Linear Extension</option>
		<option value="vlex">Vertical Linear Extension</option>
		<option value="2btw">Two-Beat Weave</option>
		<option value="supr">Superman</option>
		<option value="isob">Four-Lobe Iso-bend Toroid</option>
		<option value="antb">Four-Lobe Anti-bend Toroid</option>
		<option value="prob">Four-Lobe Pro-bend Toroid</option>
	</select>
</td>

</tr>
<tr>
<td>
Second Move:
</td>
<form></form>
<td colspan="3">
	<select id="2move" onchange="controller.updateParameters()">
		<option value="stat">Static Spin</option>
		<option value="xtsn" selected="selected">Extension</option>
		<option value="1pif">One-Petal In-Spin Flower</option>
		<option value="2pif">Two-Petal In-Spin Flower</option>
		<option value="4pif">Four-Petal In-Spin Flower</option>
		<option value="3paf">Three-Petal Anti-Spin Flower</option>
		<option value="4paf">Four-Petal Anti-Spin Flower</option>
		<option value="hcap">Horizontal C-CAP</option>
		<option value="hcpo">Horizontal C-CAP (offset)</option>
		<option value="vcap">Vertical C-CAP</option>
		<option value="vcpo">Vertical C-CAP (offset)</option>
		<option value="pend">Pendulum</option>
		<option value="1pt5">1.5</option>
		<option value="isol">Isolation</option>
		<option value="cate">Cat-Eye</option>
		<option value="hlex">Horizontal Linear Extension</option>
		<option value="vlex">Vertical Linear Extension</option>
		<option value="2btw">Two-Beat Weave</option>
		<option value="supr">Superman</option>
		<option value="isob">Four-Lobe Iso-bend Toroid</option>
		<option value="antb">Four-Lobe Anti-bend Toroid</option>
		<option value="prob">Four-Lobe Pro-bend Toroid</option>
	</select>
</td>
</tr>
<tr>
<td>
Third Move:
</td>
<form></form>
<td colspan="3">
	<select id="3move" onchange="controller.updateParameters()">
		<option value="stat">Static Spin</option>
		<option value="xtsn">Extension</option>
		<option value="1pif">One-Petal In-Spin Flower</option>
		<option value="2pif">Two-Petal In-Spin Flower</option>
		<option value="4pif">Four-Petal In-Spin Flower</option>
		<option selected="selected" value="3paf">Three-Petal Anti-Spin Flower</option>
		<option value="4paf">Four-Petal Anti-Spin Flower</option>
		<option value="hcap">Horizontal C-CAP</option>
		<option value="hcpo">Horizontal C-CAP (offset)</option>
		<option value="vcap">Vertical C-CAP</option>
		<option value="vcpo">Vertical C-CAP (offset)</option>
		<option value="pend">Pendulum</option>
		<option value="1pt5">1.5</option>
		<option value="isol">Isolation</option>
		<option value="cate">Cat-Eye</option>
		<option value="hlex">Horizontal Linear Extension</option>
		<option value="vlex">Vertical Linear Extension</option>
		<option value="2btw">Two-Beat Weave</option>
		<option value="supr">Superman</option>
		<option value="isob">Four-Lobe Iso-bend Toroid</option>
		<option value="antb">Four-Lobe Anti-bend Toroid</option>
		<option value="prob">Four-Lobe Pro-bend Toroid</option>
	</select>
</td>
</tr>
<tr>
<td>
Fourth Move:
</td>
<form></form>
<td colspan="3">
	<select id="4move" onchange="controller.updateParameters()">
		<option value="stat">Static Spin</option>
		<option value="xtsn">Extension</option>
		<option value="1pif">One-Petal In-Spin Flower</option>
		<option value="2pif">Two-Petal In-Spin Flower</option>
		<option value="4pif">Four-Petal In-Spin Flower</option>
		<option selected="selected" value="3paf">Three-Petal Anti-Spin Flower</option>
		<option value="4paf">Four-Petal Anti-Spin Flower</option>
		<option value="hcap">Horizontal C-CAP</option>
		<option value="hcpo">Horizontal C-CAP (offset)</option>
		<option value="vcap">Vertical C-CAP</option>
		<option value="vcpo">Vertical C-CAP (offset)</option>
		<option value="pend">Pendulum</option>uments/projects/visual-spinner-3d/index.html
		<option value="1pt5">1.5</option>
		<option value="isol">Isolation</option>
		<option value="cate">Cat-Eye</option>
		<option value="hlex">Horizontal Linear Extension</option>
		<option value="vlex">Vertical Linear Extension</option>
		<option value="2btw">Two-Beat Weave</option>
		<option value="supr">Superman</option>
		<option value="isob">Four-Lobe Iso-bend Toroid</option>
		<option value="antb">Four-Lobe Anti-bend Toroid</option>
		<option value="prob">Four-Lobe Pro-bend Toroid</option>
	</select>
</td>
</tr>
</tbody></table>

<p></p>
Pasteable link to these settings:
<p id="myLink"></p>
<p>Source: https://github.com/infiniteperplexity/visual-spinner-3d</p>
<p>Questions, comments, and suggestions: infinite DOT perplexity AT gmail DOT com</p>



</body></html>
