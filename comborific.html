<!--Distributed under GNU Public License version 3-->
<!DOCTYPE html>
<html><head>
<style>
body {margin: 0; padding: 0; background-color: #679}
h1, h2, header p {text-align: center}
header {width: 1240px; height: 100px}
#content {width: 1250px; height: 510px;}
canvas {width: 400px; height: 400px; background-color: #000;}
section {margin: 0; padding: 0}
header, section div {vertical-align: top; padding: 2.5px; border: 5px solid gray; margin: -2.5px; display: inline-block;}
#display {width: 400px; height: 400px; float: left}
#popimport {height: 240px; width: 400px}
#frameN {width: 100px}
</style>


<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>Drex's "combo-rific" video modeled in VisualSpinner, by Glenn Wright)</title>
<script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
<script src="scripts/gl-matrix-min.js"></script>
<script src="scripts/phoria-min.js"></script>
<script src="scripts/requestAnimationFrame.js"></script>
<script src="scripts/visual-spinner-engine.js"></script>
<script src="scripts/visual-spinner-moves.js"></script>
<script src="scripts/visual-spinner-renderers.js"></script><script>
// set parameters

var HEIGHT = 400;
var WIDTH = 400;
var ORIGINX = WIDTH/2;
var ORIGINY = HEIGHT/2;
var BACKGROUND = "black";

var view2d = false;

var myProps = new Array(); 
var moves = new MoveFactory();
var props = new PropFactory();

function init() {
	ctx=document.getElementById('canvas').getContext('2d');
	if( 	navigator.userAgent.match(/Android/i)
		|| navigator.userAgent.match(/webOS/i)
		|| navigator.userAgent.match(/iPhone/i)
		|| navigator.userAgent.match(/iPad/i)
		|| navigator.userAgent.match(/iPod/i)
		|| navigator.userAgent.match(/BlackBerry/i)
		|| navigator.userAgent.match(/Windows Phone/i)) {
		$("#2d3d").val("2d");
	} else {
		$("#2d3d").val("3d");
	}
	canvasSetup();
	//canvasLoop();
}

var scene = new Phoria.Scene();
var renderer;
var orangePoi = props.poi({head_color: "orange", scene: scene});
var whitePoi = props.poi({head_color: "white", scene: scene});
// An ad hoc solution?  Two invisible props that remember where the orange and white poi started
var startingPositions = [props.noprop({scene: scene}),props.noprop({scene: scene})];

function canvasSetup() {
	var prop = new Prop();
	var link = new MoveLink();
	var angle = SIX;
	canvas.height = HEIGHT;
	canvas.width = WIDTH;
	ctx.fillStyle = BACKGROUND;
	ctx.strokeStyle = BACKGROUND;
	ctx.fillRect(0,0,WIDTH,HEIGHT);
	
	// set up Phoria scene for 3D rendering
	scene.camera.position = {x:0.0, y:1.0, z:10.0};
	scene.perspective.aspect = canvas.width / canvas.height;
	scene.viewport.width = canvas.width;
	scene.viewport.height = canvas.height;
	renderer = new Phoria.CanvasRenderer(canvas);
	var plane = Phoria.Util.generateTesselatedPlane(8,8,0,20);
	scene.graph.push(Phoria.Entity.create({
		points: plane.points,
		edges: plane.edges,
		polygons: plane.polygons,
		style: {
				 drawmode: "wireframe",
				 shademode: "plain",
				 linewidth: 0.5,
				 objectsortmode: "back"
			}}));
	scene.graph.push(new Phoria.DistantLight());
	var light = new Phoria.DistantLight();
	light.direction.x = 1;
	light.direction.z = 0;
	scene.graph.push(light);
	light = new Phoria.DistantLight();
	light.direction.y = 1;
	light.direction.z = 0;
	scene.graph.push(light);
	
	window.addEventListener("keydown", listenForKey, false);
	
	
	// set up props
	orangePoi.hand.radius = 1;
	whitePoi.hand.radius = 0;
	orangePoi.rotateHand(SPLIT);
	orangePoi.rotateProp(SPLIT);
	whitePoi.rotateHand(SPLIT);
	whitePoi.rotateProp(SPLIT);
	startingPositions[0].orientToProp(orangePoi);
	startingPositions[1].orientToProp(whitePoi);
	myProps.push(orangePoi);
	myProps.push(whitePoi);

	// Drex begins with a counterclockwise pendulum vs. extended pendulum hybrid.
		// Note the use of "hybrid: true" on the extended pendulum.
			// This tells the hand speed the smooth path of the other pendulum's prop
			// The default (hybrid: false) instead spins at a constant speed that will match a static spin or flower
			// Note that the constant THREE, SIX, NINE, and TWELVE refer to the clock points (directions)
		// Pendulum paths are not true to real-world gravity, because I use a simplified function
	orangePoi.addFixedMove(moves.pendulum({hybrid: true, direction: COUNTERCLOCKWISE, extend: 1, duration: 0.5, entry: NINE}));
	whitePoi.addFixedMove(moves.pendulum({direction: COUNTERCLOCKWISE, extend: TINY, duration: 0.5, entry: NINE}));
	
	
	// Next Drex does a clockwise pendulum vs. antispin hybrid.  
		// The "twirl" parameter, which is mainly used for 1.5s, turns out to be useful here
	orangePoi.addMove(moves.pendulum({hybrid: true, duration: 0.5, twirl: -3, entry: THREE}));
	whitePoi.addMove(moves.pendulum({extend: 0, duration: 0.5, entry: THREE}));
	
	// Back to the original hybrid...
	orangePoi.addMove(moves.pendulum({hybrid: true, direction: COUNTERCLOCKWISE, extend: 1, duration: 0.5, entry: NINE}));
	whitePoi.addMove(moves.pendulum({direction: COUNTERCLOCKWISE, extend: 0, duration: 0.5, entry: NINE}));
	
	// ...and back to the second hybrid
	orangePoi.addMove(moves.pendulum({hybrid: true, duration: 0.5, entry: THREE, twirl: -3}));
		// As Drex transitions to the next move, he distorts the second half of the hybrid in various ways
			// The orange poi stops and reverses direction (much more slowly) and the hand holding it drifts to the right
			// (I don't think the pivoting here is essential to Drex's intent for the move...basically it switches from triquetra to cateye partway through)
	orangePoi.modifyTail({prop_speed: -1, prop_acc: 0, hand_rescale: -2});
	whitePoi.addMove(moves.pendulum({direction: CLOCKWISE, extend: 0, duration: 0.5, entry: THREE}));
			// The white poi drifts to the right so Drex can spin moves that are not centered on his body
				// VisualSpinner handles this sort of thing using the "pivot" element to recenter the move
	whitePoi.modifyTail({pivot_rescale: 2});

	
	// The next move is point isolation vs. static spin.  A point isolation can be modeled as a box-mode, zero-petal, in-spin flower.
	orangePoi.addMove(moves.flower({entry: NINE, petals: 0, pivot_angle: THREE, pivot_radius: 0.5, duration: 0.5, mode: BOX}));
	whitePoi.addMove(moves.staticspin({entry: NINE, hand: THREE, extend: 0.5, duration: 0.5}));

	// The next move is isolation vs. vertical cateye
	orangePoi.addMove(moves.isolation({entry: THREE, spin: CATEYE, pivot_angle: THREE, pivot_radius: 1, duration: 1.5}));
	whitePoi.addMove(moves.isolation({entry: NINE, pivot_angle: THREE, pivot_radius: 1, duration: 1.5}));
	
	// Then Drex does the third, "unfolding" variant of point iso vs. static spin from his Tech Blog #390
	orangePoi.addMove(moves.staticspin({entry: THREE, direction: COUNTERCLOCKWISE, hand: THREE, extend: 0.5, duration: 0.5}));
	whitePoi.addMove(moves.flower({entry: THREE, mode: BOX, direction: COUNTERCLOCKWISE, petals: 0, pivot_angle: THREE, pivot_radius: 0.5, duration: 0.25}));
	whitePoi.addMove(moves.flower({entry: TWELVE, mode: BOX, petals: 0, pivot_angle: THREE, pivot_radius: 0.5, duration: 0.25}));
	
	// Next comes static spin vs. extension, starting pivoted but recentering quickly
	orangePoi.addMove(moves.staticspin({entry: NINE, direction: COUNTERCLOCKWISE, duration: 0.5, pivot_angle: THREE, pivot_radius: 0.5}));;
	whitePoi.addMove(moves.flower({mode: BOX, entry: THREE, direction: COUNTERCLOCKWISE, petals: 0, duration: 0.5, pivot_angle: THREE, pivot_radius: 0.5}));
	orangePoi.modifyTail({pivot_rescale: 2});
	whitePoi.modifyTail({pivot_rescale: 2});
	orangePoi.addMove(moves.flower({entry: THREE, direction: COUNTERCLOCKWISE, petals: 0, duration: 0.5}));
	whitePoi.addMove(moves.staticspin({entry: THREE, direction: COUNTERCLOCKWISE, duration: 0.5}));
	
	// Next comes pendulum vs. overhead CAP
	orangePoi.addMove(moves.ccap({orient: TWELVE, direction: COUNTERCLOCKWISE, phase: 1}));
	whitePoi.addMove(moves.pendulum({direction: CLOCKWISE, extend:0, entry: NINE, duration: 1}));
	// Then repeat the same hybrid
	orangePoi.addMove(moves.ccap({orient: TWELVE, direction: COUNTERCLOCKWISE, phase: 1}));
	whitePoi.addMove(moves.pendulum({direction: CLOCKWISE, extend:0, entry: NINE, duration: 1}));
	// Then one quarter of a repetition
	orangePoi.addMove(moves.ccap({orient: TWELVE, direction: COUNTERCLOCKWISE, phase: 1, duration: 0.25}));
	whitePoi.addMove(moves.pendulum({direction: CLOCKWISE, extend:0, entry: NINE, duration: 0.25}));
	// The white poi drifts down to prepare for the next move
	whitePoi.modifyTail({hand_angle: SIX, hand_speed: 0, hand_rescale: 4});

	// The next move is a split pair of linear isolations
		// These have oval hand paths, which are a little tricky to model
	orangePoi.addMove(moves.oval({orient: TWELVE, entry: TWELVE, direction: COUNTERCLOCKWISE}));
	whitePoi.addMove(moves.oval({orient: SIX, entry: SIX, direction: COUNTERCLOCKWISE}));
	// Half a set
	orangePoi.addMove(moves.oval({orient: TWELVE, entry: TWELVE, direction: COUNTERCLOCKWISE, duration: 0.25}));
	whitePoi.addMove(moves.oval({orient: SIX, entry: SIX, direction: COUNTERCLOCKWISE, duration: 0.25}));
	
	// Transition
		// These isolations drift upwards to prepare for the next combo
		// Drex actually does this a little earlier but it's way easier to model this way
	orangePoi.addMove(moves.isolation({direction: COUNTERCLOCKWISE, entry: NINE, duration: 0.25}));
	orangePoi.modifyTail({pivot_angle: TWELVE, pivot_rescale: 4});
	whitePoi.addMove(moves.isolation({direction: COUNTERCLOCKWISE, entry: THREE, duration: 0.25}));
	whitePoi.modifyTail({pivot_angle: TWELVE, pivot_rescale: 4});
	
	//  Triquetra vs. Anti-pendulum
		// Note that a hybrid anti-pendulum does a couple of weird things...
			// The top half of it drifts up about half an extension
			// Also, it only swings about 0.75 times as far as a normal pendulum
	orangePoi.addMove(moves.flower({orient: TWELVE, spin: ANTISPIN, petals: 3, extend: 0.5, entry: TWELVE, mode: DIAMOND}));
	whitePoi.addMove(moves.antipendulum({direction: COUNTERCLOCKWISE, entry: TWELVE}));
	// Repeat once
	orangePoi.addMove(moves.flower({orient: TWELVE, spin: ANTISPIN, petals: 3, extend: 0.5, entry: TWELVE, mode: DIAMOND}));
	whitePoi.addMove(moves.antipendulum({direction: COUNTERCLOCKWISE, entry: TWELVE}));
	// Half of one more repetition
		// The white poi drifts upward to prepare for a centered isolation.
	orangePoi.addMove(moves.flower({orient: TWELVE, spin: ANTISPIN, petals: 3, extend: 0.5, entry: TWELVE, mode: DIAMOND, duration: 0.5}));
	whitePoi.addMove(moves.antipendulum({direction: COUNTERCLOCKWISE, entry: TWELVE, duration: 0.5}));
	whitePoi.modifyTail({helper_rescale: 2});
	
	// Isolation vs. Horizontal Cat-Eye
	orangePoi.addMove(moves.isolation({spin: CATEYE, entry: SIX}));
	whitePoi.addMove(moves.isolation({entry: TWELVE}));
	
	// ...and again...
	orangePoi.addMove(moves.isolation({spin: CATEYE, entry: SIX}));
	whitePoi.addMove(moves.isolation({entry: TWELVE}));
	
	// Isolation vs. Triquetra
	orangePoi.addMove(moves.flower({orient: TWELVE, spin: ANTISPIN, petals: 3, extend: 0.5, entry: SIX}));
	whitePoi.addMove(moves.isolation({entry: TWELVE}));
	
	// ...and another half cycle...
	orangePoi.addMove(moves.flower({orient: TWELVE, spin: ANTISPIN, petals: 3, extend: 0.5, entry: SIX, duration: 0.5}));
	whitePoi.addMove(moves.isolation({entry: TWELVE, duration: 0.5}));

	// ...leading into Isolation vs. Vertical Cat-Eye
	orangePoi.addMove(moves.isolation({spin: CATEYE, offset: NOOFFSET, entry: TWELVE, duration: 1}));
	whitePoi.addMove(moves.isolation({entry: SIX, duration: 1}));
	// ...and three-quarters of another repetitition
	orangePoi.addMove(moves.isolation({spin: CATEYE, offset: NOOFFSET, entry: TWELVE, duration: 0.75}));
	whitePoi.addMove(moves.isolation({entry: SIX, duration: 0.75}));
	
	// Point Isolation vs. Static Spin
	orangePoi.addMove(moves.staticspin({entry: THREE, hand: NINE, direction: COUNTERCLOCKWISE, extend: 0.5, duration: 0.5}));
	whitePoi.addMove(moves.flower({entry: THREE, mode: BOX, petals: 0, direction: COUNTERCLOCKWISE, pivot_angle: NINE, pivot_radius: 0.5, duration: 0.5}));

	// Pivoted Cat-Eyes vs. Anti-Pendulums
		// ...attention folks, the storm clouds are about to roll in...
	
	// The orange poi turns half an isolation and then does an anti-pendulum
	orangePoi.addMove(moves.isolation({direction: COUNTERCLOCKWISE, entry: THREE, pivot_angle: NINE, pivot_radius: 1, duration: 0.5}));
		// We have to do some custom slicing and dicing to make the transition work	
	orangePoi.addMove(moves.antipendulum({entry: NINE, pivot_angle: NINE, pivot_radius: 1, helper_radius: 0, swing: 1, duration: 0.25}));
		// ??? Strange bug: workaround is to set helper_angle explicitly
	orangePoi.modifyTail({helper_rescale: 4, helper_rescale_acc: -16, helper_angle: TWELVE});
	orangePoi.addMove(moves.antipendulum({entry: TWELVE, pivot_angle: NINE, pivot_radius: 1, duration: 0.75}));
	// And then a little more slicing and dicing to prepare for the point iso
	orangePoi.modifyTail({prop_acc: 4, helper_rescale_acc: -16}); 
	// The white poi is much more straightforward
	whitePoi.addMove(moves.isolation({spin: CATEYE, direction: COUNTERCLOCKWISE, entry: NINE, pivot_angle: NINE, pivot_radius: 1, duration: 1.5}));

	// Point isolation vs. Static Spin
	orangePoi.addMove(moves.flower({entry: NINE, mode: BOX, petals: 0, pivot_angle: NINE, pivot_radius: 0.5, duration: 0.5}));
	whitePoi.addMove(moves.staticspin({entry: NINE, hand: NINE, extend: 0.5, duration: 0.5}));
	
	// Cat-Eye vs. Anti-Pendulum (switch hands)
	orangePoi.addMove(moves.isolation({spin: CATEYE, entry: THREE, duration: 1.5}));
	whitePoi.addMove(moves.isolation({entry: NINE, duration: 0.5}));
		// More custom slicing and dicing
	whitePoi.addMove(moves.antipendulum({direction: COUNTERCLOCKWISE, entry: THREE, helper_radius: 0, swing: 1, duration: 0.25}));
		//??? Again, workaround for that strange bug
	whitePoi.modifyTail({helper_rescale: 4, helper_rescale_acc: -16, helper_angle: TWELVE});
	whitePoi.addMove(moves.antipendulum({direction: COUNTERCLOCKWISE, entry: TWELVE, duration: 0.75}));
	whitePoi.modifyTail({prop_acc: -4, helper_rescale_acc: -16});
	
	// Point Iso v. Static Spin
	orangePoi.addMove(moves.staticspin({hand: NINE, direction: COUNTERCLOCKWISE, extend: 0.5, duration: 0.5}));
	whitePoi.addMove(moves.flower({mode: BOX, petals: 0, direction: COUNTERCLOCKWISE, pivot_angle: NINE, pivot_radius: 0.5, duration: 0.5}));
	
	// Iso v. V. Cat-eye
	orangePoi.addMove(moves.isolation({direction: COUNTERCLOCKWISE, entry: THREE, pivot_angle: NINE, pivot_radius: 1, duration: 1.5}));
	whitePoi.addMove(moves.isolation({spin: CATEYE, direction: COUNTERCLOCKWISE, entry: NINE, pivot_angle: NINE, pivot_radius: 1, duration: 1.5}));
	// Point Iso v. Static Spin
		// The complicated pivot going on here makes it easier to just use generic movements
	orangePoi.addMove(moves.generic({hand_angle: NINE, prop_angle: THREE, pivot_angle: NINE, pivot_radius: 1, pivot_rescale: -3, hand_radius: 0.5, hand_speed: -1, prop_speed: -1, duration: 0.5}));
	whitePoi.addMove(moves.generic({hand_angle: THREE, prop_angle: NINE, pivot_angle: NINE, pivot_radius: 1, pivot_rescale: -3, hand_radius: 0.5, hand_speed: -1, prop_speed: -1, duration: 0.5}));

	// Iso v. V. Cat-eye
	orangePoi.addMove(moves.isolation({spin: CATEYE, entry: THREE, pivot_angle: THREE, pivot_radius: 0.5, duration: 1.5}));
	whitePoi.addMove(moves.isolation({entry: NINE, pivot_angle: THREE, pivot_radius: 0.5, duration: 1.5}));
	
	// Pendulum v. Two-Petal transition
		// The first "petal" weirdly pendulum-like and distorted so it's best handled as a generic move
	orangePoi.addMove(moves.generic({hand_angle: NINE, prop_angle: THREE, hand_radius: 1, pivot_angle: THREE, pivot_radius: 1, hand_speed: 0, hand_acc: -8, prop_speed: 0, prop_acc: -24, duration: 0.25}));
	orangePoi.addMove(moves.generic({hand_angle: SIX, prop_angle: SIX, hand_radius: 1, pivot_angle: THREE, pivot_radius: 1, hand_speed: -2, hand_acc: 8, prop_speed: -6, prop_acc: 24, duration: 0.25, pivot_rescale: -4}));
	whitePoi.addMove(moves.pendulum({extend: 0, duration: 0.5, entry: NINE, pivot_angle: THREE, pivot_radius: 1}));
		// Put a bit of "isolation" into the pendulum to recenter it.
	whitePoi.modifyTail({pivot_rescale: -4});
	
	
	// Five repetitions of static pendulum vs. inside stalls
		// one
	orangePoi.addMove(moves.stall({exit: true, mode: BOX, entry: THREE, petals: 2, direction: COUNTERCLOCKWISE, duration: 0.25}));
	orangePoi.addMove(moves.stall({exit: false, entry: TWELVE, petals: 2, direction: COUNTERCLOCKWISE, duration: 0.25}));
	whitePoi.addMove(moves.pendulum({extend: 0, duration: 0.5, entry: THREE}));
		// two
	orangePoi.addMove(moves.stall({exit: true, entry: NINE, mode: BOX, petals: 2, duration: 0.25}));
	orangePoi.addMove(moves.stall({exit: false, entry: TWELVE, petals: 2, duration: 0.25}));
	whitePoi.addMove(moves.pendulum({extend: 0, duration: 0.5, entry: NINE}));
		// three
	orangePoi.addMove(moves.stall({exit: true, mode: BOX, entry: THREE, petals: 2, direction: COUNTERCLOCKWISE, duration: 0.25}));
	orangePoi.addMove(moves.stall({exit: false, entry: TWELVE, petals: 2, direction: COUNTERCLOCKWISE, duration: 0.25}));
	whitePoi.addMove(moves.pendulum({extend: 0, duration: 0.5, entry: THREE}));
		// four
	orangePoi.addMove(moves.stall({exit: true, entry: NINE, mode: BOX, petals: 2, duration: 0.25}));
	orangePoi.addMove(moves.stall({exit: false, entry: TWELVE, petals: 2, duration: 0.25}));
	whitePoi.addMove(moves.pendulum({extend: 0, duration: 0.5, entry: NINE}));
		// five
	orangePoi.addMove(moves.stall({exit: true, mode: BOX, entry: THREE, petals: 2, direction: COUNTERCLOCKWISE, duration: 0.25}));
	orangePoi.addMove(moves.stall({exit: false, entry: TWELVE, petals: 2, direction: COUNTERCLOCKWISE, duration: 0.25}));
	whitePoi.addMove(moves.pendulum({extend: 0, duration: 0.5, entry: THREE}));

	// Two and a half beats of good old fashioned crank isolations
	orangePoi.addMove(moves.isolation({entry: NINE, direction: COUNTERCLOCKWISE, pivot_angle: NINE, pivot_radius: 0.5, duration: 2.5}));
	whitePoi.addMove(moves.isolation({entry: THREE, direction: COUNTERCLOCKWISE, pivot_angle: NINE, pivot_radius: 0.5, duration: 2.5}));
	// White poi speeds up slightly to begin next hybrid
	whitePoi.modifyTail({prop_speed: -2});
	
	// Static Spin vs. One-Petal
	orangePoi.addMove(moves.staticspin({entry: NINE, direction: COUNTERCLOCKWISE, duration: 2.75}));
	whitePoi.addMove(moves.flower({entry: NINE, mode: -QUARTER, petals: 1, direction: COUNTERCLOCKWISE, duration: 2.75}));
	// At the end, drift down to do some crank isolations
	orangePoi.modifyTail({pivot_angle: SIX, pivot_rescale: 2});
	whitePoi.modifyTail({pivot_angle: SIX, pivot_rescale: 2});
	
	// One and a half beats of crank isolations
	orangePoi.addMove(moves.isolation({entry: SIX, direction: COUNTERCLOCKWISE,duration: 1.5}));
	whitePoi.addMove(moves.isolation({entry: TWELVE, direction: COUNTERCLOCKWISE, duration: 1.5}));
	
	// Oval-shaped "linear" isolations
	orangePoi.addMove(moves.oval({direction: COUNTERCLOCKWISE, entry: TWELVE, orient: NINE, duration: 0.5}));
	whitePoi.addMove(moves.oval({direction: COUNTERCLOCKWISE, entry: SIX, orient: THREE, duration: 0.5}));

	// What's this?  A three-eighth time transition?  What kind of Colorado weed is Drex smoking?
	orangePoi.addMove(moves.isolation({entry: SIX, direction: COUNTERCLOCKWISE, duration: 0.5}));
	whitePoi.addMove(moves.isolation({entry: TWELVE, direction: COUNTERCLOCKWISE, duration: 0.5}))
	orangePoi.modifyTail({duration: 0.125});
	whitePoi.modifyTail({duration: 0.125});
	
	// The orange poi does a diagonal linear isolation in the 10:30 direction, white in the 4:30 direction
	orangePoi.addMove(moves.oval({direction: COUNTERCLOCKWISE, entry: ONETHIRTY, orient: TENTHIRTY, duration: 0.5}));
	whitePoi.addMove(moves.oval({direction: COUNTERCLOCKWISE, entry: SEVENTHIRTY, orient: FOURTHIRTY, duration: 0.5}));
	
	// This set of linear isolations is extremely distorted, and threw me for quite a loop
	orangePoi.addMove(moves.generic({hand_angle: SEVENTHIRTY, prop_angle: ONETHIRTY, hand_radius: 0.5, hand_rescale: 2, prop_speed: -2, duration: 0.25}));
	whitePoi.addMove(moves.generic({hand_angle: ONETHIRTY, prop_angle: SEVENTHIRTY, hand_radius: 0.5, hand_rescale: 2, prop_speed: -2, duration: 0.25}));
	orangePoi.addMove(moves.oval({direction: COUNTERCLOCKWISE, petals: 1, minor: 0.075, entry: SEVENTHIRTY, orient: SEVENTHIRTY, duration: 0.25}));
	whitePoi.addMove(moves.oval({direction: COUNTERCLOCKWISE, petals: 1, minor: 0.075, entry: ONETHIRTY, orient: ONETHIRTY, duration: 0.25}));
	orangePoi.modifyTail({duration: 0.125});
	whitePoi.modifyTail({duration: 0.125});
	
	// Another weird "linear" transition
	orangePoi.addMove(moves.generic({hand_angle: SIX, prop_angle: FOURTHIRTY, hand_radius: 0.25, hand_rescale: 3, prop_speed: -3.5, duration: 0.25}));
	whitePoi.addMove(moves.generic({hand_angle: TWELVE, prop_angle: TENTHIRTY, hand_radius: 0.25, hand_rescale: 3, prop_speed: -3.5, duration: 0.25}));
	
	// True linear isolations
	orangePoi.addMove(moves.linex({direction: COUNTERCLOCKWISE, petals: 2, entry: SIX, orient: SIX, duration: 0.5}));
	whitePoi.addMove(moves.linex({direction: COUNTERCLOCKWISE, petals: 2, entry: TWELVE, orient: TWELVE, duration: 0.5}));
	
	// Back to "linear" isolations
	orangePoi.addMove(moves.oval({direction: COUNTERCLOCKWISE, entry: TWELVE, orient: TWELVE, duration: 0.5}));
	whitePoi.addMove(moves.oval({direction: COUNTERCLOCKWISE, entry: SIX, orient: SIX, duration: 0.5}));
	
	// Four-petal antispin flowers
	orangePoi.addMove(moves.flower({entry: SIX, spin: ANTISPIN, duration: 1.5}));
	whitePoi.addMove(moves.flower({entry: TWELVE, spin: ANTISPIN, duration: 1.5}));
	
	// Partial linear isolation back to the center
	orangePoi.addMove(moves.linex({direction: COUNTERCLOCKWISE, petals: 2, entry: TWELVE, orient: TWELVE, duration: 0.25}));
	whitePoi.addMove(moves.linex({direction: COUNTERCLOCKWISE, petals: 2, entry: SIX, orient: SIX, duration: 0.25}));
	
	// Finish with a spiral wrap
	orangePoi.addMove(moves.spiral({speed: 2, direction: COUNTERCLOCKWISE, entry: THREE, rescale: -1.5,duration: 0.5}));
	whitePoi.addMove(moves.spiral({speed: 2, direction: COUNTERCLOCKWISE, entry: NINE, rescale: -1.5, duration: 0.5}));
	
	// Finally, the madness is over!
	document.getElementById("frameN").setAttribute("max", (orangePoi.move.getDuration()*BEAT).toString());
	redraw();
}

Prop.prototype.spinfail = function() {
	alert("can't spin with an empty queue");
}

// animation loop
var paused = false;

function startSpin() {
	paused = false;
	canvasLoop();
}

function pauseSpin() {
	paused = true;
}

function spinFrames(n) {
	if (n > 0) {
		pauseSpin();
		advanceFrames(n);
	} else if (n < 0) {
		var value = parseInt(document.getElementById("frameN").value);
		totalReset();
		// This nonsense is necessary because it currently sometimes spins one additional frame after resetting
		advanceFrames(value + n - parseInt(document.getElementById("frameN").value));
	}
	for (var i = 0; i < myProps.length; i++) {
		myProps[i].render();
	}
	redraw();
}

//omg this is so stupid, the thing sometimes spins 1 additional frame after reseting.
function totalReset() {
	pauseSpin();
	document.getElementById("frameN").value = "0";
	for (var i= 0; i < myProps.length; i++) {
		myProps[i].move.reset();
		myProps[i].orientToProp(startingPositions[i]);
	}
	redraw();
}

function listenForKey(e) {
	if (e.keyCode ===13) {
		goToFrame();
	} else if (e.keyCode===37) {
		spinFrames(-12);
	} else if (e.keyCode===39) {
		spinFrames(12);
	}
}

// currently this doesn't actually check the lower bound
function checkBounds(n) {
	var max = document.getElementById("frameN").max;
	if (n > max) {
		frameN.value = max.toString();
		while (n > max) {
			n = n-max;
		}
	} else if (n < 0) {
		alert("You entered a negative frame number and I haven't done error handling for that yet.");
	}
	return n;
}
function goToFrame() {
	var value = parseInt(document.getElementById("frameN").value);
	value = checkBounds(value);
	totalReset();
	advanceFrames(value);
	redraw();
}

function advanceFrames(n) {
	var frameN = document.getElementById("frameN");
	frameN.value = checkBounds((parseInt(frameN.value) + n)).toString();
	for (var i = 0; i < n; i++) {
		for (var j = 0;  j < myProps.length; j++) {
			myProps[j].spin();
		}
	}
}
function canvasLoop() {
	if (paused == true) {return;}
	setTimeout(function() {
		requestAnimationFrame(canvasLoop);
		redraw();
		advanceFrames(1);
		for (var i = 0; i < myProps.length; i++) {
			myProps[i].render();
		}
	},500/BEAT);
}

function redraw() {
	for (var i = 0; i < myProps.length; i++) {
		myProps[i].render();
	}
	if (view2d == true) {
		ctx.fillStyle = "rgba(0,0,0,0.01)";
		ctx.strokeStyle=BACKGROUND;
		ctx.fillRect(0,0,WIDTH,HEIGHT);
	}
	else {
		scene.modelView();
		renderer.render(scene);
	}
}

</script>
</head>
<body onload="init();">
<header>
	<h1>Welcome to VisualSpinner3D. </h1>
	<p>(we have successfully digitized Drex.)</p>
</header>
	<section>
<div id="display">
	<canvas width="400" height="400" id="canvas">
		Your browser doesn't support the HTML5 element canvas.
	</canvas>
	<button type="button" onclick="startSpin();">Play</button>
	<button type="button" onclick="pauseSpin();">Pause</button>
	<button type="button" onclick="spinFrames(-12)">-</button>
	<input id="frameN" min="0" value="0" type="number">
	<button type="button" onclick="spinFrames(12)";>+</button>
	<button type="button" onclick="totalReset();">Reset</button>
	<textarea rows = "50" cols = "150">
//// **** This is what the JavaScript code used to interact with the VisualSpinner engine looks like ****////

	// set up props
	orangePoi.hand.radius = 1;
	whitePoi.hand.radius = 0;
	orangePoi.rotateHand(NINE);
	orangePoi.rotateProp(NINE);
	whitePoi.rotateHand(NINE);
	whitePoi.rotateProp(NINE);

	// Drex begins with a counterclockwise pendulum vs. extended pendulum hybrid.
		// Note the use of "hybrid: true" on the extended pendulum.
			// This tells the hand speed the smooth path of the other pendulum's prop
			// The default (hybrid: false) instead spins at a constant speed that will match a static spin or flower
			// Note that the constant THREE, SIX, NINE, and TWELVE refer to the clock points (directions)
		// Pendulum paths are not true to real-world gravity, because I use a simplified function
	orangePoi.addFixedMove(moves.pendulum({hybrid: true, direction: COUNTERCLOCKWISE, extend: 1, duration: 0.5, entry: NINE}));
	whitePoi.addFixedMove(moves.pendulum({direction: COUNTERCLOCKWISE, extend: TINY, duration: 0.5, entry: NINE}));
	
	
	// Next Drex does a clockwise pendulum vs. antispin hybrid.  
		// The "twirl" parameter, which is mainly used for 1.5s, turns out to be useful here
	orangePoi.addMove(moves.pendulum({hybrid: true, duration: 0.5, twirl: -3, entry: THREE}));
	whitePoi.addMove(moves.pendulum({extend: 0, duration: 0.5, entry: THREE}));
	
	// Back to the original hybrid...
	orangePoi.addMove(moves.pendulum({hybrid: true, direction: COUNTERCLOCKWISE, extend: 1, duration: 0.5, entry: NINE}));
	whitePoi.addMove(moves.pendulum({direction: COUNTERCLOCKWISE, extend: 0, duration: 0.5, entry: NINE}));
	
	// ...and back to the second hybrid
	orangePoi.addMove(moves.pendulum({hybrid: true, duration: 0.5, entry: THREE, twirl: -3}));
		// As Drex transitions to the next move, he distorts the second half of the hybrid in various ways
			// The orange poi stops and reverses direction (much more slowly) and the hand holding it drifts to the right
			// (I don't think the pivoting here is essential to Drex's intent for the move...basically it switches from triquetra to cateye partway through)
	orangePoi.modifyTail({prop_speed: -1, prop_acc: 0, hand_rescale: -2});
	whitePoi.addMove(moves.pendulum({direction: CLOCKWISE, extend: 0, duration: 0.5, entry: THREE}));
			// The white poi drifts to the right so Drex can spin moves that are not centered on his body
				// VisualSpinner handles this sort of thing using the "pivot" element to recenter the move
	whitePoi.modifyTail({pivot_rescale: 2});

	
	// The next move is point isolation vs. static spin.  A point isolation can be modeled as a box-mode, zero-petal, in-spin flower.
	orangePoi.addMove(moves.flower({entry: NINE, petals: 0, pivot_angle: THREE, pivot_radius: 0.5, duration: 0.5, mode: BOX}));
	whitePoi.addMove(moves.staticspin({entry: NINE, hand: THREE, extend: 0.5, duration: 0.5}));

	// The next move is isolation vs. vertical cateye
	orangePoi.addMove(moves.isolation({entry: THREE, spin: CATEYE, pivot_angle: THREE, pivot_radius: 1, duration: 1.5}));
	whitePoi.addMove(moves.isolation({entry: NINE, pivot_angle: THREE, pivot_radius: 1, duration: 1.5}));
	
	// Then Drex does the third, "unfolding" variant of point iso vs. static spin from his Tech Blog #390
	orangePoi.addMove(moves.staticspin({entry: THREE, direction: COUNTERCLOCKWISE, hand: THREE, extend: 0.5, duration: 0.5}));
	whitePoi.addMove(moves.flower({entry: THREE, mode: BOX, direction: COUNTERCLOCKWISE, petals: 0, pivot_angle: THREE, pivot_radius: 0.5, duration: 0.25}));
	whitePoi.addMove(moves.flower({entry: TWELVE, mode: BOX, petals: 0, pivot_angle: THREE, pivot_radius: 0.5, duration: 0.25}));
	
	// Next comes static spin vs. extension, starting pivoted but recentering quickly
	orangePoi.addMove(moves.staticspin({entry: NINE, direction: COUNTERCLOCKWISE, duration: 0.5, pivot_angle: THREE, pivot_radius: 0.5}));;
	whitePoi.addMove(moves.flower({mode: BOX, entry: THREE, direction: COUNTERCLOCKWISE, petals: 0, duration: 0.5, pivot_angle: THREE, pivot_radius: 0.5}));
	orangePoi.modifyTail({pivot_rescale: 2});
	whitePoi.modifyTail({pivot_rescale: 2});
	orangePoi.addMove(moves.flower({entry: THREE, direction: COUNTERCLOCKWISE, petals: 0, duration: 0.5}));
	whitePoi.addMove(moves.staticspin({entry: THREE, direction: COUNTERCLOCKWISE, duration: 0.5}));
	
	// Next comes pendulum vs. overhead CAP
	orangePoi.addMove(moves.ccap({orient: TWELVE, direction: COUNTERCLOCKWISE, phase: 1}));
	whitePoi.addMove(moves.pendulum({direction: CLOCKWISE, extend:0, entry: NINE, duration: 1}));
	// Then repeat the same hybrid
	orangePoi.addMove(moves.ccap({orient: TWELVE, direction: COUNTERCLOCKWISE, phase: 1}));
	whitePoi.addMove(moves.pendulum({direction: CLOCKWISE, extend:0, entry: NINE, duration: 1}));
	// Then one quarter of a repetition
	orangePoi.addMove(moves.ccap({orient: TWELVE, direction: COUNTERCLOCKWISE, phase: 1, duration: 0.25}));
	whitePoi.addMove(moves.pendulum({direction: CLOCKWISE, extend:0, entry: NINE, duration: 0.25}));
	// The white poi drifts down to prepare for the next move
	whitePoi.modifyTail({hand_angle: SIX, hand_speed: 0, hand_rescale: 4});

	// The next move is a split pair of linear isolations
		// These have oval hand paths, which are a little tricky to model
	orangePoi.addMove(moves.oval({orient: TWELVE, entry: TWELVE, direction: COUNTERCLOCKWISE}));
	whitePoi.addMove(moves.oval({orient: SIX, entry: SIX, direction: COUNTERCLOCKWISE}));
	// Half a set
	orangePoi.addMove(moves.oval({orient: TWELVE, entry: TWELVE, direction: COUNTERCLOCKWISE, duration: 0.25}));
	whitePoi.addMove(moves.oval({orient: SIX, entry: SIX, direction: COUNTERCLOCKWISE, duration: 0.25}));
	
	// Transition
		// These isolations drift upwards to prepare for the next combo
		// Drex actually does this a little earlier but it's way easier to model this way
	orangePoi.addMove(moves.isolation({direction: COUNTERCLOCKWISE, entry: NINE, duration: 0.25}));
	orangePoi.modifyTail({pivot_angle: TWELVE, pivot_rescale: 4});
	whitePoi.addMove(moves.isolation({direction: COUNTERCLOCKWISE, entry: THREE, duration: 0.25}));
	whitePoi.modifyTail({pivot_angle: TWELVE, pivot_rescale: 4});
	
	//  Triquetra vs. Anti-pendulum
		// Note that a hybrid anti-pendulum does a couple of weird things...
			// The top half of it drifts up about half an extension
			// Also, it only swings about 0.75 times as far as a normal pendulum
	orangePoi.addMove(moves.flower({orient: TWELVE, spin: ANTISPIN, petals: 3, extend: 0.5, entry: TWELVE, mode: DIAMOND}));
	whitePoi.addMove(moves.antipendulum({direction: COUNTERCLOCKWISE, entry: TWELVE}));
	// Repeat once
	orangePoi.addMove(moves.flower({orient: TWELVE, spin: ANTISPIN, petals: 3, extend: 0.5, entry: TWELVE, mode: DIAMOND}));
	whitePoi.addMove(moves.antipendulum({direction: COUNTERCLOCKWISE, entry: TWELVE}));
	// Half of one more repetition
		// The white poi drifts upward to prepare for a centered isolation.
	orangePoi.addMove(moves.flower({orient: TWELVE, spin: ANTISPIN, petals: 3, extend: 0.5, entry: TWELVE, mode: DIAMOND, duration: 0.5}));
	whitePoi.addMove(moves.antipendulum({direction: COUNTERCLOCKWISE, entry: TWELVE, duration: 0.5}));
	whitePoi.modifyTail({helper_rescale: 2});
	
	// Isolation vs. Horizontal Cat-Eye
	orangePoi.addMove(moves.isolation({spin: CATEYE, entry: SIX}));
	whitePoi.addMove(moves.isolation({entry: TWELVE}));
	
	// ...and again...
	orangePoi.addMove(moves.isolation({spin: CATEYE, entry: SIX}));
	whitePoi.addMove(moves.isolation({entry: TWELVE}));
	
	// Isolation vs. Triquetra
	orangePoi.addMove(moves.flower({orient: TWELVE, spin: ANTISPIN, petals: 3, extend: 0.5, entry: SIX}));
	whitePoi.addMove(moves.isolation({entry: TWELVE}));
	
	// ...and another half cycle...
	orangePoi.addMove(moves.flower({orient: TWELVE, spin: ANTISPIN, petals: 3, extend: 0.5, entry: SIX, duration: 0.5}));
	whitePoi.addMove(moves.isolation({entry: TWELVE, duration: 0.5}));

	// ...leading into Isolation vs. Vertical Cat-Eye
	orangePoi.addMove(moves.isolation({spin: CATEYE, offset: NOOFFSET, entry: TWELVE, duration: 1}));
	whitePoi.addMove(moves.isolation({entry: SIX, duration: 1}));
	// ...and three-quarters of another repetitition
	orangePoi.addMove(moves.isolation({spin: CATEYE, offset: NOOFFSET, entry: TWELVE, duration: 0.75}));
	whitePoi.addMove(moves.isolation({entry: SIX, duration: 0.75}));
	
	// Point Isolation vs. Static Spin
	orangePoi.addMove(moves.staticspin({entry: THREE, hand: NINE, direction: COUNTERCLOCKWISE, extend: 0.5, duration: 0.5}));
	whitePoi.addMove(moves.flower({entry: THREE, mode: BOX, petals: 0, direction: COUNTERCLOCKWISE, pivot_angle: NINE, pivot_radius: 0.5, duration: 0.5}));

	// Pivoted Cat-Eyes vs. Anti-Pendulums
		// ...attention folks, the storm clouds are about to roll in...
	
	// The orange poi turns half an isolation and then does an anti-pendulum
	orangePoi.addMove(moves.isolation({direction: COUNTERCLOCKWISE, entry: THREE, pivot_angle: NINE, pivot_radius: 1, duration: 0.5}));
		// We have to do some custom slicing and dicing to make the transition work	
	orangePoi.addMove(moves.antipendulum({entry: NINE, pivot_angle: NINE, pivot_radius: 1, helper_radius: 0, swing: 1, duration: 0.25}));
		// ??? Strange bug: workaround is to set helper_angle explicitly
	orangePoi.modifyTail({helper_rescale: 4, helper_rescale_acc: -16, helper_angle: TWELVE});
	orangePoi.addMove(moves.antipendulum({entry: TWELVE, pivot_angle: NINE, pivot_radius: 1, duration: 0.75}));
	// And then a little more slicing and dicing to prepare for the point iso
	orangePoi.modifyTail({prop_acc: 4, helper_rescale_acc: -16}); 
	// The white poi is much more straightforward
	whitePoi.addMove(moves.isolation({spin: CATEYE, direction: COUNTERCLOCKWISE, entry: NINE, pivot_angle: NINE, pivot_radius: 1, duration: 1.5}));

	// Point isolation vs. Static Spin
	orangePoi.addMove(moves.flower({entry: NINE, mode: BOX, petals: 0, pivot_angle: NINE, pivot_radius: 0.5, duration: 0.5}));
	whitePoi.addMove(moves.staticspin({entry: NINE, hand: NINE, extend: 0.5, duration: 0.5}));
	
	// Cat-Eye vs. Anti-Pendulum (switch hands)
	orangePoi.addMove(moves.isolation({spin: CATEYE, entry: THREE, duration: 1.5}));
	whitePoi.addMove(moves.isolation({entry: NINE, duration: 0.5}));
		// More custom slicing and dicing
	whitePoi.addMove(moves.antipendulum({direction: COUNTERCLOCKWISE, entry: THREE, helper_radius: 0, swing: 1, duration: 0.25}));
		//??? Again, workaround for that strange bug
	whitePoi.modifyTail({helper_rescale: 4, helper_rescale_acc: -16, helper_angle: TWELVE});
	whitePoi.addMove(moves.antipendulum({direction: COUNTERCLOCKWISE, entry: TWELVE, duration: 0.75}));
	whitePoi.modifyTail({prop_acc: -4, helper_rescale_acc: -16});
	
	// Point Iso v. Static Spin
	orangePoi.addMove(moves.staticspin({hand: NINE, direction: COUNTERCLOCKWISE, extend: 0.5, duration: 0.5}));
	whitePoi.addMove(moves.flower({mode: BOX, petals: 0, direction: COUNTERCLOCKWISE, pivot_angle: NINE, pivot_radius: 0.5, duration: 0.5}));
	
	// Iso v. V. Cat-eye
	orangePoi.addMove(moves.isolation({direction: COUNTERCLOCKWISE, entry: THREE, pivot_angle: NINE, pivot_radius: 1, duration: 1.5}));
	whitePoi.addMove(moves.isolation({spin: CATEYE, direction: COUNTERCLOCKWISE, entry: NINE, pivot_angle: NINE, pivot_radius: 1, duration: 1.5}));
	// Point Iso v. Static Spin
		// The complicated pivot going on here makes it easier to just use generic movements
	orangePoi.addMove(moves.generic({hand_angle: NINE, prop_angle: THREE, pivot_angle: NINE, pivot_radius: 1, pivot_rescale: -3, hand_radius: 0.5, hand_speed: -1, prop_speed: -1, duration: 0.5}));
	whitePoi.addMove(moves.generic({hand_angle: THREE, prop_angle: NINE, pivot_angle: NINE, pivot_radius: 1, pivot_rescale: -3, hand_radius: 0.5, hand_speed: -1, prop_speed: -1, duration: 0.5}));

	// Iso v. V. Cat-eye
	orangePoi.addMove(moves.isolation({spin: CATEYE, entry: THREE, pivot_angle: THREE, pivot_radius: 0.5, duration: 1.5}));
	whitePoi.addMove(moves.isolation({entry: NINE, pivot_angle: THREE, pivot_radius: 0.5, duration: 1.5}));
	
	// Pendulum v. Two-Petal transition
		// The first "petal" weirdly pendulum-like and distorted so it's best handled as a generic move
	orangePoi.addMove(moves.generic({hand_angle: NINE, prop_angle: THREE, hand_radius: 1, pivot_angle: THREE, pivot_radius: 1, hand_speed: 0, hand_acc: -8, prop_speed: 0, prop_acc: -24, duration: 0.25}));
	orangePoi.addMove(moves.generic({hand_angle: SIX, prop_angle: SIX, hand_radius: 1, pivot_angle: THREE, pivot_radius: 1, hand_speed: -2, hand_acc: 8, prop_speed: -6, prop_acc: 24, duration: 0.25, pivot_rescale: -4}));
	whitePoi.addMove(moves.pendulum({extend: 0, duration: 0.5, entry: NINE, pivot_angle: THREE, pivot_radius: 1}));
		// Put a bit of "isolation" into the pendulum to recenter it.
	whitePoi.modifyTail({pivot_rescale: -4});
	
	
	// Five repetitions of static pendulum vs. inside stalls
		// one
	orangePoi.addMove(moves.stall({exit: true, mode: BOX, entry: THREE, petals: 2, direction: COUNTERCLOCKWISE, duration: 0.25}));
	orangePoi.addMove(moves.stall({exit: false, entry: TWELVE, petals: 2, direction: COUNTERCLOCKWISE, duration: 0.25}));
	whitePoi.addMove(moves.pendulum({extend: 0, duration: 0.5, entry: THREE}));
		// two
	orangePoi.addMove(moves.stall({exit: true, entry: NINE, mode: BOX, petals: 2, duration: 0.25}));
	orangePoi.addMove(moves.stall({exit: false, entry: TWELVE, petals: 2, duration: 0.25}));
	whitePoi.addMove(moves.pendulum({extend: 0, duration: 0.5, entry: NINE}));
		// three
	orangePoi.addMove(moves.stall({exit: true, mode: BOX, entry: THREE, petals: 2, direction: COUNTERCLOCKWISE, duration: 0.25}));
	orangePoi.addMove(moves.stall({exit: false, entry: TWELVE, petals: 2, direction: COUNTERCLOCKWISE, duration: 0.25}));
	whitePoi.addMove(moves.pendulum({extend: 0, duration: 0.5, entry: THREE}));
		// four
	orangePoi.addMove(moves.stall({exit: true, entry: NINE, mode: BOX, petals: 2, duration: 0.25}));
	orangePoi.addMove(moves.stall({exit: false, entry: TWELVE, petals: 2, duration: 0.25}));
	whitePoi.addMove(moves.pendulum({extend: 0, duration: 0.5, entry: NINE}));
		// five
	orangePoi.addMove(moves.stall({exit: true, mode: BOX, entry: THREE, petals: 2, direction: COUNTERCLOCKWISE, duration: 0.25}));
	orangePoi.addMove(moves.stall({exit: false, entry: TWELVE, petals: 2, direction: COUNTERCLOCKWISE, duration: 0.25}));
	whitePoi.addMove(moves.pendulum({extend: 0, duration: 0.5, entry: THREE}));

	// Two and a half beats of good old fashioned crank isolations
	orangePoi.addMove(moves.isolation({entry: NINE, direction: COUNTERCLOCKWISE, pivot_angle: NINE, pivot_radius: 0.5, duration: 2.5}));
	whitePoi.addMove(moves.isolation({entry: THREE, direction: COUNTERCLOCKWISE, pivot_angle: NINE, pivot_radius: 0.5, duration: 2.5}));
	// White poi speeds up slightly to begin next hybrid
	whitePoi.modifyTail({prop_speed: -2});
	
	// Static Spin vs. One-Petal
	orangePoi.addMove(moves.staticspin({entry: NINE, direction: COUNTERCLOCKWISE, duration: 2.75}));
	whitePoi.addMove(moves.flower({entry: NINE, mode: -QUARTER, petals: 1, direction: COUNTERCLOCKWISE, duration: 2.75}));
	// At the end, drift down to do some crank isolations
	orangePoi.modifyTail({pivot_angle: SIX, pivot_rescale: 2});
	whitePoi.modifyTail({pivot_angle: SIX, pivot_rescale: 2});
	
	// One and a half beats of crank isolations
	orangePoi.addMove(moves.isolation({entry: SIX, direction: COUNTERCLOCKWISE,duration: 1.5}));
	whitePoi.addMove(moves.isolation({entry: TWELVE, direction: COUNTERCLOCKWISE, duration: 1.5}));
	
	// Oval-shaped "linear" isolations
	orangePoi.addMove(moves.oval({direction: COUNTERCLOCKWISE, entry: TWELVE, orient: NINE, duration: 0.5}));
	whitePoi.addMove(moves.oval({direction: COUNTERCLOCKWISE, entry: SIX, orient: THREE, duration: 0.5}));

	// What's this?  A three-eighth time transition?  What kind of Colorado weed is Drex smoking?
	orangePoi.addMove(moves.isolation({entry: SIX, direction: COUNTERCLOCKWISE, duration: 0.5}));
	whitePoi.addMove(moves.isolation({entry: TWELVE, direction: COUNTERCLOCKWISE, duration: 0.5}))
	orangePoi.modifyTail({duration: 0.125});
	whitePoi.modifyTail({duration: 0.125});
	
	// The orange poi does a diagonal linear isolation in the 10:30 direction, white in the 4:30 direction
	orangePoi.addMove(moves.oval({direction: COUNTERCLOCKWISE, entry: ONETHIRTY, orient: TENTHIRTY, duration: 0.5}));
	whitePoi.addMove(moves.oval({direction: COUNTERCLOCKWISE, entry: SEVENTHIRTY, orient: FOURTHIRTY, duration: 0.5}));
	
	// This set of linear isolations is extremely distorted, and threw me for quite a loop
	orangePoi.addMove(moves.generic({hand_angle: SEVENTHIRTY, prop_angle: ONETHIRTY, hand_radius: 0.5, hand_rescale: 2, prop_speed: -2, duration: 0.25}));
	whitePoi.addMove(moves.generic({hand_angle: ONETHIRTY, prop_angle: SEVENTHIRTY, hand_radius: 0.5, hand_rescale: 2, prop_speed: -2, duration: 0.25}));
	orangePoi.addMove(moves.oval({direction: COUNTERCLOCKWISE, petals: 1, minor: 0.075, entry: SEVENTHIRTY, orient: SEVENTHIRTY, duration: 0.25}));
	whitePoi.addMove(moves.oval({direction: COUNTERCLOCKWISE, petals: 1, minor: 0.075, entry: ONETHIRTY, orient: ONETHIRTY, duration: 0.25}));
	orangePoi.modifyTail({duration: 0.125});
	whitePoi.modifyTail({duration: 0.125});
	
	// Another weird "linear" transition
	orangePoi.addMove(moves.generic({hand_angle: SIX, prop_angle: FOURTHIRTY, hand_radius: 0.25, hand_rescale: 3, prop_speed: -3.5, duration: 0.25}));
	whitePoi.addMove(moves.generic({hand_angle: TWELVE, prop_angle: TENTHIRTY, hand_radius: 0.25, hand_rescale: 3, prop_speed: -3.5, duration: 0.25}));
	
	// True linear isolations
	orangePoi.addMove(moves.linex({direction: COUNTERCLOCKWISE, petals: 2, entry: SIX, orient: SIX, duration: 0.5}));
	whitePoi.addMove(moves.linex({direction: COUNTERCLOCKWISE, petals: 2, entry: TWELVE, orient: TWELVE, duration: 0.5}));
	
	// Back to "linear" isolations
	orangePoi.addMove(moves.oval({direction: COUNTERCLOCKWISE, entry: TWELVE, orient: TWELVE, duration: 0.5}));
	whitePoi.addMove(moves.oval({direction: COUNTERCLOCKWISE, entry: SIX, orient: SIX, duration: 0.5}));
	
	// Four-petal antispin flowers
	orangePoi.addMove(moves.flower({entry: SIX, spin: ANTISPIN, duration: 1.5}));
	whitePoi.addMove(moves.flower({entry: TWELVE, spin: ANTISPIN, duration: 1.5}));
	
	// Partial linear isolation back to the center
	orangePoi.addMove(moves.linex({direction: COUNTERCLOCKWISE, petals: 2, entry: TWELVE, orient: TWELVE, duration: 0.25}));
	whitePoi.addMove(moves.linex({direction: COUNTERCLOCKWISE, petals: 2, entry: SIX, orient: SIX, duration: 0.25}));
	
	// Finish with a spiral wrap
	orangePoi.addMove(moves.spiral({speed: 2, direction: COUNTERCLOCKWISE, entry: THREE, rescale: -1.5,duration: 0.5}));
	whitePoi.addMove(moves.spiral({speed: 2, direction: COUNTERCLOCKWISE, entry: NINE, rescale: -1.5, duration: 0.5}));
		</textarea>
</div>
<div id="vid">
	<video id="drex" width="400px" controls>
		<source src="comborific.mp4" type="video/mp4">
		Your browser does not support HTML5 video.
	</video>
</div>

</section>
</body></html>