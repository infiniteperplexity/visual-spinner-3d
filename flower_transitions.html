<!--Distributed under GNU Public License version 3-->
<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>Four-Petal Anti-Spin Flower Transitions Demo (using the VisualSpinner Engine)</title>
<script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
<script src="scripts/gl-matrix-min.js"></script>
<script src="scripts/phoria-min.js"></script>
<script src="scripts/requestAnimationFrame.js"></script>
<script src="scripts/visual-spinner-engine.js"></script>
<script src="scripts/visual-spinner-moves.js"></script>
<script src="scripts/visual-spinner-renderers.js"></script><script>
// set parameters
var HEIGHT = 400;
var WIDTH = 800;
var ORIGINX = WIDTH/2;
var ORIGINY = HEIGHT/2;
var BACKGROUND = "black";

var view2d = true;

var myProps = new Array(); 
var moves = new MoveFactory();
var props = new PropFactory();

function init() {
	ctx=document.getElementById('canvas').getContext('2d');
	canvasSetup();
	canvasLoop();
}

var scene;
var renderer;
function canvasSetup() {
	canvas.height = HEIGHT;
	canvas.width = WIDTH;
	ctx.fillStyle = BACKGROUND;
	ctx.strokeStyle = BACKGROUND;
	ctx.fillRect(0,0,WIDTH,HEIGHT);
	
	// set up Phoria scene for 3D rendering
	scene = new Phoria.Scene();
	scene.camera.position = {x:0.0, y:1.0, z:10.0};
	scene.perspective.aspect = canvas.width / canvas.height;
	scene.viewport.width = canvas.width;
	scene.viewport.height = canvas.height;
	renderer = new Phoria.CanvasRenderer(canvas);
	var plane = Phoria.Util.generateTesselatedPlane(8,8,0,20);
	scene.graph.push(Phoria.Entity.create({
		points: plane.points,
		edges: plane.edges,
		polygons: plane.polygons,
		style: {
				 drawmode: "wireframe",
				 shademode: "plain",
				 linewidth: 0.5,
				 objectsortmode: "back"
			}}));
	scene.graph.push(new Phoria.DistantLight());
	var light = new Phoria.DistantLight();
	light.direction.x = 1;
	light.direction.z = 0;
	scene.graph.push(light);
	light = new Phoria.DistantLight();
	light.direction.y = 1;
	light.direction.z = 0;
	scene.graph.push(light);
	// set up props
	var propOne = props.poi2d({head_color: "red", scene: scene});
	var propTwo = props.poi2d({head_color: "blue", scene: scene});
	propOne.nudge(3,0,0);
	propTwo.nudge(3.1,0,0);
	propOne.hand.radius = 1;
	propTwo.hand.radius = 1;
	myProps.push(propOne);
	myProps.push(propTwo);
	var propThree = props.poi2d({head_color: "yellow", scene: scene});
	var propFour = props.poi2d({head_color: "green", scene: scene});
	propThree.nudge(-3,0,0);
	propFour.nudge(-3.1,0,0);
	propThree.hand.angle = NINE;
	propThree.prop.angle = NINE;
	propFour.hand.angle = NINE;
	propFour.prop.angle = NINE;
	propThree.hand.radius = 1;
	propFour.hand.radius = 1;
	myProps.push(propThree);
	myProps.push(propFour);
	var doublemove;
	for (var i = 0; i<8; i++) {
		doublemove = moves.twoPropFlower({mode: (i%2)*SPLIT, direction: CLOCKWISE, spin: ANTISPIN, duration: (i==4) ? 1 : 1.25});
		propOne.addPartnership(doublemove, propTwo);
		doublemove = moves.twoPropFlower({mode: (i%2)*SPLIT, direction: COUNTERCLOCKWISE, spin: ANTISPIN, duration: (i==4) ? 1 : 1.25});
		propThree.addPartnership(doublemove, propFour);
	}
}
	
// animation loop
function canvasLoop() {
	setTimeout(function() {
		requestAnimationFrame(canvasLoop);
		redraw();
		for (var i = 0; i < myProps.length; i++) {
			myProps[i].spin();
			myProps[i].render();
		}
	},1000/BEAT);
}
function redraw() {
	if (view2d == true) {
		ctx.fillStyle = "rgba(0,0,0,0.03)";
		ctx.strokeStyle=BACKGROUND;
		ctx.fillRect(0,0,WIDTH,HEIGHT);
	}
	else {
		scene.modelView();
		renderer.render(scene);
	}
}

</script>
</head><body onload="init();">
<table>
<tbody><tr>
<td rowspan="9" colspan="2">
	<canvas width="400" height="400" id="canvas" style="background-color: #000">
		Your browser doesn't support the HTML5 element canvas.
	</canvas>
</td>
</tr>
</tbody></table>
<p>Using the VisualSpinner Engine, someone with basic programming knowledge can easily create complex patterns.</p>
<p>Here is the code that drives the entire pattern:</p>
<p></p>
<p>for (var i = 0; i<8; i++) {</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;doublemove = moves.twoPropFlower({mode: (i%2)*SPLIT , direction: CLOCKWISE, spin: ANTISPIN, duration: (i==4) ? 1 : 1.25});</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;propOne.addPartnership(doublemove, propTwo);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;doublemove = moves.twoPropFlower({mode: (i%2)*SPLIT , direction: COUNTERCLOCKWISE, spin: ANTISPIN, duration: (i==4) ? 1 : 1.25});</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;propThree.addPartnership(doublemove, propFour);</p>
<p>}</p>
</body></html>
