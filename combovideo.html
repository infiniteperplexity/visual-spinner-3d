<!--Distributed under GNU Public License version 3-->
<!DOCTYPE html>
<html><head>
<style>
body {background-color: #99CCFF}
#grid {
	display: grid;
	grid-column-gap: 3px;
	grid-row-gap: 3px;
	grid-template-columns: 400px auto;
}
video {
	height: 400px;
}
</style>



<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>Drex's "combo-rific" video modeled in VisualSpinner, by Glenn Wright)</title>
<script src="scripts/vs3d.js"></script>
<script src="scripts/vs3d-moves.js"></script>
<script src="scripts/three.min.js"></script>
<script src="scripts/vs3d-render.js"></script>
<script src="https://www.youtube.com/iframe_api"></script>
<script>

function init() {
	vidControls();
}

let player, bookmarker, controls;
function vidControls() {
	player = new YT.Player('player', {
        width: '854',
        height: '480',
        videoId: '05tyrZonnmw',
        events: {
        	onReady: updateBookmarker,
        	onStateChange: updateBookmarker
        }
    });
    bookmarker = new VS3D.Bookmarker();
    bookmarker.getTime = function() {
    	if (!player.getCurrentTime) {
    		return 0;
    	}
    	return parseFloat(VS3D.round(player.getCurrentTime(), 1/this.RATE));
    }
    bookmarker.setTime = function(t) {
    	t = VS3D.round(t, 1/this.RATE);
    	console.log("seeking to");
    	console.log(t);
    	player.seekTo(t);
    }
	controls = document.getElementById("controls");
	input = document.getElementById("frame");
	bookmarker.update = function() {
    	input.value = this.getTime();
    	let books = document.getElementById("bookmarks");
		books.innerHTML = "<option value='null'>(bookmarks)</option>";
		let selected = false;
		for (let mark of this.bookmarks) {
			let node = document.createElement("option");
			node.innerHTML = mark;
			node.value = mark;
			if (VS3D.nearly(parseFloat(mark), this.getTime())) {
				node.selected = true;
				selected = true;
			}
			books.appendChild(node);
		}
		if (!selected) {
			books.firstChild.selected = true;
		}
    }
	bookmarker.update();
}

function updateBookmarker() {
	bookmarker.update();
}
function chooseBookmark() {
	let val = this.target.value;
	video.currentTime = parseFloat(e.target.value);
	update();
}

function addBookmark() {
	bookmarker.add();
}

function deleteBookmark() {
	bookmarker.remove();
}
function backFrame() {
	bookmarker.goto(Math.max(0, bookmarker.getTime()-1/bookmarker.RATE));
}
function forwardFrame() {
	// do these things handle duration the way they should anyway?
	console.log(bookmarker.getTime());
	console.log(1/bookmarker.RATE);
	bookmarker.goto(bookmarker.getTime()+1/bookmarker.RATE);
}
function chooseTime(e) {
	let val = e.target.value;
	if (parseFloat(val)===parseFloat(String(parseFloat(val)))) {
		setTime(parseFloat(val));
	}
}
</script>
</head>
<body onload="init();">
<header>
</header>
<div id="grid">
	<div>
		<div id="player"></div>
		<div id="controls">
			<select onChange="chooseBookmark();" id="bookmarks">
			</select>
			<button onClick="addBookmark();">Add bookmark.</button>
			<button onClick="deleteBookmark();">Delete bookmark.</button>
			<button onClick="backFrame();">&lt;=</button>
			<input id="frame" onInput="chooseTime();" type="text"></input>
			<button onClick="forwardFrame();">=&gt;</button>
		</div>
	</div>
</div>
</grid>
</body></html>

