<!--Distributed under GNU Public License version 3-->
<!DOCTYPE html>
<html><head>
<style>
body {background-color: #99CCFF}
#grid {
	display: grid;
	grid-column-gap: 3px;
	grid-row-gap: 3px;
	grid-template-columns: 400px auto;
}
video {
	height: 400px;
}
</style>



<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>Drex's "combo-rific" video modeled in VisualSpinner, by Glenn Wright)</title>
<script src="scripts/vs3d.js"></script>
<script src="scripts/vs3d-moves.js"></script>
<script src="scripts/three.min.js"></script>
<script src="scripts/vs3d-render.js"></script><script>

function init() {
	vidControls();
}

function getTime() {
	return video.currentTime.toFixed(3);
}

function setTime(t) {
	video.currentTime = t;
}

function update() {
	updateFrame;
}

const RATE = 24;
let renderer, player, orange, white, video, controls, input;


function vidControls() {
	video = document.getElementById("vid");
	video.onTimeUpdate = update;
	controls = document.getElementById("controls");
	input = document.getElementById("frame");
	updateFrame();
	updateBookmarks();
}

/*
	- so basically, the bookmarker needs two callbacks for sure...	
		- setTime
		- getTime
			- possibly maxTime
			- possibly validate
		- it probably needs contents for a div, maybe.


*/

function updateFrame() {
	// this is a validation thing...
	setTime(VS3D.round(getTime(), 1/RATE));
	input.value = getTime();
}
let bookmarks = [];

function chooseBookmark() {
	let val = this.target.value;
	video.currentTime = parseFloat(e.target.value);
	updateBookmarks();
}
function updateBookmarks() {
	let books = document.getElementById("bookmarks");
	books.innerHTML = "<option value='null'>(bookmarks)</option>";
	let selected = false;
	for (let mark of bookmarks) {
		let node = document.createElement("option");
		node.innerHTML = mark;
		node.value = mark;
		if (VS3D.nearly(parseFloat(mark), getTime())) {
			node.selected = true;
			selected = true;
		}
		books.appendChild(node);
	}
	if (!selected) {
		books.firstChild.selected = true;
	}
}
function addBookmark() {
	updateFrame();
	for (let mark of bookmarks) {
		if (VS3D.nearly(getTime(), mark)) {
			return;
		}
	}
	bookmarks.push(parseFloat(getTime()));
	updateBookmarks();
}
function deleteBookmark() {
	updateFrame();
	let i = 0;
	while (i<bookmarks.length) {
		if (VS3D.nearly(bookmarks[i], getTime())) {
			bookmarks.splice(i,1);
		}
	}
	updateBookmarks();
}
function backFrame() {
	setTime(Math.max(0, getTime() - 1/RATE));
	updateFrame();
}
function forwardFrame() {
	// do these things handle duration the way they should anyway?
	setTime(Math.min(video.duration, getTime() + 1/RATE));
	updateFrame();
}
function chooseTime(e) {
	let val = e.target.value;
	if (VS3D.nearly(parseFloat(val), parseFloat(String(parseFloat(val))))) {
		setTime(parseFloat(val));
	}
}
</script>
</head>
<body onload="init();">
<header>
</header>
<div id="grid">
	<div>
		<iframe width="854" height="480" src="https://www.youtube.com/embed/05tyrZonnmw" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
		<div id="controls">
			<select onChange="chooseBookmark();" id="bookmarks">
			</select>
			<button onClick="addBookmark();">Add bookmark.</button>
			<button onClick="deleteBookmark();">Delete bookmark.</button>
			<button onClick="backFrame();">&lt;=</button>
			<input id="frame" onInput="chooseTime();" type="text"></input>
			<button onClick="forwardFrame();">=&gt;</button>
			
		</div>
	</div>
</div>
</grid>
</body></html>

